/*
    *
    * Wijmo Library 5.20172.334
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";function tryGetModuleWijmoGridDetail(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.detail}function tryGetModuleWijmoGridMultirow(){var n,t;return(n=window.wijmo)&&(t=n.grid)&&t.multirow}var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wjcSelf,FlexGridXlsxConverter,XlsxFormatItemEventArgs;Object.defineProperty(exports,"__esModule",{value:!0});var wjcGrid=require("wijmo/wijmo.grid"),wjcXlsx=require("wijmo/wijmo.xlsx"),wjcCore=require("wijmo/wijmo");wjcSelf=require("wijmo/wijmo.grid.xlsx");window.wijmo=window.wijmo||{};window.wijmo.grid=window.wijmo.grid||{};window.wijmo.grid.xlsx=wjcSelf;FlexGridXlsxConverter=function(){function n(){}return n.save=function(n,t,i){var r=this._saveFlexGridToWorkbook(n,t);return i&&r.save(i),r},n.saveAsync=function(n,t,i,r,u){var f=this._saveFlexGridToWorkbook(n,t);return f.saveAsync(i,r,u),f},n.load=function(n,t,i){var f=this,r,u;if(t instanceof Blob)r=new FileReader,r.onload=function(){var u=wjcXlsx.Workbook._base64EncArr(new Uint8Array(r.result)),t=new wjcXlsx.Workbook;t.load(u);u=null;n.deferUpdate(function(){f._loadToFlexGrid(n,t,i);t=null})},r.readAsArrayBuffer(t);else if(t instanceof wjcXlsx.Workbook)n.deferUpdate(function(){f._loadToFlexGrid(n,t,i);t=null});else{if(t instanceof ArrayBuffer)t=wjcXlsx.Workbook._base64EncArr(new Uint8Array(t));else if(!wjcCore.isString(t))throw'Invalid workbook.';u=new wjcXlsx.Workbook;u.load(t);t=null;n.deferUpdate(function(){f._loadToFlexGrid(n,u,i);u=null})}},n.loadAsync=function(n,t,i,r,u){var e=this,f,o;if(t instanceof Blob)f=new FileReader,f.onload=function(){var t=wjcXlsx.Workbook._base64EncArr(new Uint8Array(f.result)),o=new wjcXlsx.Workbook;o.loadAsync(t,function(u){t=null;o=null;n.deferUpdate(function(){e._loadToFlexGrid(n,u,i);r&&r(u);u=null})},u)},f.readAsArrayBuffer(t);else if(t instanceof wjcXlsx.Workbook)n.deferUpdate(function(){e._loadToFlexGrid(n,t,i);r&&r(t);t=null});else{if(t instanceof ArrayBuffer)t=wjcXlsx.Workbook._base64EncArr(new Uint8Array(t));else if(!wjcCore.isString(t))throw'Invalid workbook.';o=new wjcXlsx.Workbook;o.loadAsync(t,function(u){t=null;n.deferUpdate(function(){e._loadToFlexGrid(n,u,i);r&&r(u);u=null})},u)}},n._saveFlexGridToWorkbook=function(n,t){var nt=new wjcXlsx.Workbook,s=new wjcXlsx.WorkSheet,ut=new wjcXlsx.WorkbookStyle,tt=new wjcXlsx.WorkbookFrozenPane,ft=t&&t.includeColumnHeaders!=null?t.includeColumnHeaders:!0,d=t&&t.includeRowHeaders!=null?t.includeRowHeaders:!1,y=t&&t.includeCellStyles!=null?t.includeCellStyles:!0,ht=t?t.activeWorksheet:null,c=t?t.includeColumns:null,b=t?t.formatItem:null,u,l,p,a,v,f,et,i,e,r,it,h,k,ot,w,rt=0,g=0,st=0,o=0;if(it=n.wj_sheetInfo,s.name=t?t.sheetName:'',s.visible=t?t.sheetVisible!==!1:!0,et={borders:{top:{style:wjcXlsx.BorderStyle.Thin,color:'#C6C6C6'},left:{style:wjcXlsx.BorderStyle.Thin,color:'#C6C6C6'},bottom:{style:wjcXlsx.BorderStyle.Thin,color:'#C6C6C6'},right:{style:wjcXlsx.BorderStyle.Thin,color:'#C6C6C6'}}},ut._deserialize(et),s.style=ut,f=[],!it&&(y||b)&&(h=document.createElement('div'),h.style.visibility='hidden',h.setAttribute(wjcGrid.FlexGrid._WJS_MEASURE,'true'),n.hostElement.appendChild(h)),d){for(e=0,i=0;i<n.rowHeaders.rows.length;i++)if(!(n.rowHeaders.rows[i].renderSize<=0)){for(f[e]=[],r=0;r<n.rowHeaders.columns.length;r++)p=n._getBindingColumn(n.rowHeaders,i,n.rowHeaders.columns[r]),a=this._getColumnSetting(p,n.columnHeaders.columns.defaultSize),f[e][r]=a,e===0&&(v=new wjcXlsx.WorkbookColumn,v._deserialize(a),s._addWorkbookColumn(v,r));e++}o=r}if(ft&&n.columnHeaders.rows.length>0){for(e=0,i=0;i<n.columnHeaders.rows.length;i++)if(!(n.columnHeaders.rows[i].renderSize<=0)){for(f[e]||(f[e]=[]),r=0;r<n.columnHeaders.columns.length;r++)p=n._getBindingColumn(n.columnHeaders,i,n.columnHeaders.columns[r]),a=this._getColumnSetting(p,n.columnHeaders.columns.defaultSize),f[e][o+r]=a,e===0&&(!c||c(p))&&(v=new wjcXlsx.WorkbookColumn,v._deserialize(a),s._addWorkbookColumn(v));o=0;u={};l=new wjcXlsx.WorkbookRow;d&&(o=this._parseFlexGridRowToSheetRow(n.topLeftCells,u,i,0,f,y,h,!1,0,c));this._parseFlexGridRowToSheetRow(n.columnHeaders,u,i,o,f,y,h,!1,0,c);u.cells.length>0&&(l._deserialize(u),s._addWorkbookRow(l,e));e++}g=e}else for(f[0]||(f[0]=[]),r=0;r<n.columnHeaders.columns.length;r++)p=n._getBindingColumn(n.columnHeaders,0,n.columnHeaders.columns[r]),a=this._getColumnSetting(p,n.columnHeaders.columns.defaultSize),f[0][o+r]=a,(!c||c(p))&&(v=new wjcXlsx.WorkbookColumn,v._deserialize(a),s._addWorkbookColumn(v));for(i=0;i<n.cells.rows.length;i++)(o=0,u={},l=new wjcXlsx.WorkbookRow,k=n.rows[i],k instanceof wjcGrid._NewRowTemplate)||(w=k instanceof wjcGrid.GroupRow,w&&(ot=wjcCore.tryCast(k,wjcGrid.GroupRow),rt=ot.level+1),d&&(o=this._parseFlexGridRowToSheetRow(n.rowHeaders,u,i,0,f,y,h,w,rt,c,b)),this._parseFlexGridRowToSheetRow(n.cells,u,i,o,f,y,h,w,rt,c,b),u.cells.length>0&&(l._deserialize(u),s._addWorkbookRow(l,g+i)));for(st=n.cells.rows.length,i=0;i<n.columnFooters.rows.length;i++)o=0,u={},l=new wjcXlsx.WorkbookRow,k=n.columnFooters.rows[i],w=k instanceof wjcGrid.GroupRow,d&&(o=this._parseFlexGridRowToSheetRow(n.rowHeaders,u,i,0,f,y,h,w,0,c,b)),this._parseFlexGridRowToSheetRow(n.columnFooters,u,i,o,f,y,h,w,0,c,b),u.cells.length>0&&(l._deserialize(u),s._addWorkbookRow(l,g+st+i));return tt.rows=ft?n.frozenRows+g:n.frozenRows,tt.columns=d?n.frozenColumns+o:n.frozenColumns,s.frozenPane=tt,nt._addWorkSheet(s),!it&&(y||b)&&n.hostElement.removeChild(h),nt.activeWorksheet=ht,nt},n._loadToFlexGrid=function(n,t,i){var ii=i&&i.includeColumnHeaders!=null?i.includeColumnHeaders:!0,p=i&&i.includeColumnHeaders!=null?i.includeColumnHeaders:!0,vt=i&&i.sheetIndex!=null&&!isNaN(i.sheetIndex)?i.sheetIndex:0,bt=i?i.sheetName:null,ri=i?i.sheetVisible:!0,kt=n.wj_sheetInfo!=null,u=0,e=0,y,tt,a,it,b,w,rt,yt,g,dt,f,s,gt,k,ut,o,ft,et,ni,pt,c,ot,d,v,h,r,l,wt,st,ht,ti,nt,ct=!1,lt={},at;if(n.itemsSource=null,n.columns.clear(),n.rows.clear(),n.frozenColumns=0,n.frozenRows=0,l={},wt={},e=0,it=[],st=[],vt<0||vt>=t.sheets.length)throw'The sheet index option is out of the sheet range of current workbook.';if(bt!=null)for(y=0;y<t.sheets.length;y++)if(bt===t.sheets[y].name){s=t.sheets[y];break}if(s=s||t.sheets[vt],s.rows!=null){for(ii&&(e=1,s.rows.length<=1&&(p=!1,e=0),yt=s.rows[0]),k=this._getColumnCount(s.rows),gt=this._getRowCount(s.rows,k),ni=s.summaryBelow,a=s.columns,u=0;u<k;u++)n.columns.push(new wjcGrid.Column),!a[u]||(isNaN(+a[u].width)||(n.columns[u].width=+a[u].width),a[u].visible||a[u].visible==undefined||(n.columns[u].visible=!!a[u].visible),a[u].style&&!!a[u].style.wordWrap&&(n.columns[u].wordWrap=a[u].style.wordWrap));for(;e<gt;e++){if(ut=!1,at=!0,f=s.rows[e],f)for(ft=e+1;ft<s.rows.length;)if(et=s.rows[ft],et){(isNaN(f.groupLevel)&&!isNaN(et.groupLevel)||!isNaN(f.groupLevel)&&f.groupLevel<et.groupLevel)&&(ut=!0);break}else ft++;for(ut&&!ni?(c&&(c.isCollapsed=ct),c=new wjcGrid.GroupRow,c.isReadOnly=!1,ct=f.collapsed==null?!1:f.collapsed,c.level=isNaN(f.groupLevel)?0:f.groupLevel,lt[c.level]=ct,this._checkParentCollapsed(lt,c.level)&&c._setFlag(wjcGrid.RowColFlags.ParentCollapsed,!0),n.rows.push(c)):(pt=new wjcGrid.Row,f&&this._checkParentCollapsed(lt,f.groupLevel)&&pt._setFlag(wjcGrid.RowColFlags.ParentCollapsed,!0),n.rows.push(pt)),!f||!f.height||isNaN(f.height)||(n.rows[p?e-1:e].height=f.height),u=0;u<k;u++)if(f){if(o=f.cells[u],v=o?o.formula:undefined,v&&v[0]!=='='&&(v='='+v),v=v?this._parseToFlexSheetFormula(v):undefined,n.setCellData(p?e-1:e,u,v&&kt?v:this._getItemValue(o)),ut||this._setColumn(it,u,o),h=e*k+u,r=o?o.style:undefined,ht=wjcXlsx.Workbook._parseExcelFormat(o),r){if(at=at&&!!r.wordWrap,ti=this._getItemType(o),r.hAlign)nt=wjcXlsx.Workbook._parseHAlignToString(wjcCore.asEnum(r.hAlign,wjcXlsx.HAlign));else switch(ti){case wjcCore.DataType.Number:nt='right';break;case wjcCore.DataType.Boolean:nt='center';break;default:nt=ht&&ht.search(/[n,c,p]/i)===0?'right':'left'}l[h]={fontWeight:r.font&&r.font.bold?'bold':'none',fontStyle:r.font&&r.font.italic?'italic':'none',textDecoration:r.font&&r.font.underline?'underline':'none',textAlign:nt,fontFamily:r.font&&r.font.family?r.font.family:'',fontSize:r.font&&r.font.size?r.font.size+'px':'',color:r.font&&r.font.color?r.font.color:'',backgroundColor:r.fill&&r.fill.color?r.fill.color:'',whiteSpace:r.wordWrap?'pre-wrap':'normal',format:ht};r.borders&&(r.borders.left&&(this._parseBorderStyle(r.borders.left.style,'Left',l[h]),l[h].borderLeftColor=r.borders.left.color),r.borders.right&&(this._parseBorderStyle(r.borders.right.style,'Right',l[h]),l[h].borderRightColor=r.borders.right.color),r.borders.top&&(this._parseBorderStyle(r.borders.top.style,'Top',l[h]),l[h].borderTopColor=r.borders.top.color),r.borders.bottom&&(this._parseBorderStyle(r.borders.bottom.style,'Bottom',l[h]),l[h].borderBottomColor=r.borders.bottom.color));r.font&&st.indexOf(r.font.family)===-1&&st.push(r.font.family)}if(o&&wjcCore.isNumber(o.rowSpan)&&o.rowSpan>0&&wjcCore.isNumber(o.colSpan)&&o.colSpan>0&&(o.rowSpan>1||o.colSpan>1))for(y=e;y<e+o.rowSpan;y++)for(tt=u;tt<u+o.colSpan;tt++)h=y*k+tt,wt[h]=new wjcGrid.CellRange(e,u,e+o.rowSpan-1,u+o.colSpan-1)}else n.setCellData(p?e-1:e,u,''),this._setColumn(it,u,undefined);f&&(this._checkParentCollapsed(lt,f.groupLevel)||f.visible||f.visible==undefined||(n.rows[p?e-1:e].visible=f.visible),n.rows[p?e-1:e].wordWrap=!!f.style&&!!f.style.wordWrap||at)}for(c&&(c.isCollapsed=ct),s.frozenPane&&(ot=s.frozenPane.columns,wjcCore.isNumber(ot)&&!isNaN(ot)&&(n.frozenColumns=ot),d=s.frozenPane.rows,wjcCore.isNumber(d)&&!isNaN(d)&&(n.frozenRows=p&&d>0?d-1:d)),u=0;u<n.columnHeaders.columns.length;u++)b=it[u],w=n.columns[u],w.isRequired=!1,p?(g=yt?yt.cells[u]:undefined,g&&g.value?(dt=wjcXlsx.Workbook._parseExcelFormat(g),rt=wjcCore.Globalize.format(g.value,dt)):rt=this._numAlpha(u)):rt=this._numAlpha(u),w.header=rt,b&&(b.dataType===wjcCore.DataType.Boolean&&(w.dataType=b.dataType),w.format=b.format,w.align=b.hAlign,w.wordWrap=w.wordWrap||b.wordWrap);kt&&(n.wj_sheetInfo.name=s.name,n.wj_sheetInfo.visible=ri===!0?!0:s.visible!==!1,n.wj_sheetInfo.styledCells=l,n.wj_sheetInfo.mergedRanges=wt,n.wj_sheetInfo.fonts=st)}},n._parseFlexGridRowToSheetRow=function(n,t,i,r,u,f,e,o,s,h,c){var b,y,nt,l,it,a,v,k,d,et,rt,at,tt,p,st,ht,ot,w,yt=!1,ct,ut,pt,lt,vt,g,ft,wt;for(b=n.grid,ot=b.wj_sheetInfo,y=n.rows[i],pt=y.recordIndex!=null?y.recordIndex:0,t.cells||(t.cells=[]),t.visible=y.isVisible,t.height=y.renderHeight||n.rows.defaultSize,t.groupLevel=o?s-1:s,o&&(t.collapsed=y.isCollapsed),y.wordWrap&&(t.style={wordWrap:y.wordWrap}),(y.constructor===wjcGrid.Row||y.constructor===wjcGrid._NewRowTemplate||tryGetModuleWijmoGridDetail()&&y.constructor===tryGetModuleWijmoGridDetail().DetailRow||tryGetModuleWijmoGridMultirow()&&y.constructor===tryGetModuleWijmoGridMultirow()._MultiRow)&&(yt=!0),l=0;l<n.columns.length;l++)if(it=null,ht=1,st=1,ut=!1,tt=null,ft=null,ct=b._getBindingColumn(n,i,n.columns[l]),p=null,ot&&n===b.cells?(at=i*n.columns.length+l,ot.mergedRanges&&(p=ot.mergedRanges[at]),ot.styledCells&&(tt=ot.styledCells[at])):f&&(g=e.cloneNode(),e.parentElement.appendChild(g),p=b.getMergedRange(n,i,l,!1),tt=p?this._getCellStyle(n,g,i+p.rowSpan-1,l+p.columnSpan-1)||{}:this._getCellStyle(n,g,i,l)||{}),p||(p=b.getMergedRange(n,i,l,!1)),p?i===p.topRow&&l===p.leftCol&&(st=p.bottomRow-p.topRow+1,ht=this._getColSpan(n,p,h),ut=!0):ut=!0,!h||h(ct)){if(nt=u[pt][l+r],yt||o?(v=ut?n.getCellData(i,l,!0):null,k=ut?n.getCellData(i,l,!1):null,et=!1,v&&wjcCore.isString(v)&&v.length>1&&v[0]==='='&&(et=!0),w=wjcCore.isDate(k),tt&&tt.format?(it=tt.format,a=wjcXlsx.Workbook._parseCellFormat(tt.format,w)):nt&&nt.style&&nt.style.format?(it=ct.format,a=nt.style.format):a=null,a||(w?a='m/d/yyyy':wjcCore.isNumber(k)&&!ct.dataMap?a=wjcCore.isInt(k)?'#,##0':'#,##0.00':et?(rt=v.toLowerCase(),rt==='=now()'?(a='m/d/yyyy h:mm',w=!0):rt==='=today()'||rt.substring(0,rt.indexOf('('))==='=date'?(a='m/d/yyyy',w=!0):rt.substring(0,rt.indexOf('('))==='=time'&&(a='h:mm AM/PM',w=!0)):a='General')):(v=ut?b.columnHeaders.getCellData(0,l,!0):null,a='General'),ft=this._parseCellStyle(tt)||{},n===b.cells&&o&&y.hasChildren&&l===b.columns.firstVisibleIndex){if(v?d=v:ut&&(d=y.getGroupHeader().replace(/<\/?\w+>/g,'')),d==null&&!tt)continue;w=wjcCore.isDate(d);!w&&it&&it.toLowerCase()==='d'&&wjcCore.isInt(d)&&(a='0');d=typeof d=='string'?wjcXlsx.Workbook._unescapeXML(d):d;lt={value:d,isDate:w,formula:et?this._parseToExcelFormula(v,w):null,colSpan:ht,rowSpan:st,style:this._extend(ft,{format:a,font:{bold:!0},hAlign:wjcXlsx.HAlign.Left,indent:s-1})}}else v=typeof v=='string'?wjcXlsx.Workbook._unescapeXML(v):v,k=typeof k=='string'?wjcXlsx.Workbook._unescapeXML(k):k,!w&&it&&it.toLowerCase()==='d'&&wjcCore.isInt(k)&&(a='0'),wt=ft&&ft.hAlign?ft.hAlign:nt&&nt.style&&nt.style.hAlign!=null?wjcCore.asEnum(nt.style.hAlign,wjcXlsx.HAlign,!0):wjcCore.isDate(k)?wjcXlsx.HAlign.Left:wjcXlsx.HAlign.General,lt={value:et?undefined:a==='General'?v:k,isDate:w,formula:et?this._parseToExcelFormula(v,w):null,colSpan:l<b.columns.firstVisibleIndex?1:ht,rowSpan:st,style:this._extend(ft,{format:a,hAlign:wt,vAlign:st>1?n===b.cells?wjcXlsx.VAlign.Top:wjcXlsx.VAlign.Center:null})};c&&(vt=new XlsxFormatItemEventArgs(n,new wjcGrid.CellRange(i,l),g,e,lt),c(vt),g=vt.cell);g&&(g.parentElement.removeChild(g),g=null);t.cells.push(lt)}return r+l},n._parseCellStyle=function(n){var t,r,f,i,u;return n==null?null:(t=n.fontSize,t=t?+t.substring(0,t.indexOf('px')):null,isNaN(t)&&(t=null),r=n.fontWeight,r=r==='bold'||+r>=700,f=n.fontStyle==='italic',i=n.textDecorationStyle,i==null&&(i=n.textDecoration),i=i==='underline',u=n.whiteSpace,u=u?u.indexOf('pre')>-1?!0:!1:!1,{font:{bold:r,italic:f,underline:i,family:this._parseToExcelFontFamily(n.fontFamily),size:t,color:n.color},fill:{color:n.backgroundColor},borders:this._parseBorder(n),hAlign:wjcXlsx.Workbook._parseStringToHAlign(n.textAlign),wordWrap:u})},n._parseBorder=function(n){var t={};return t.left=this._parseEgdeBorder(n,'Left'),t.right=this._parseEgdeBorder(n,'Right'),t.top=this._parseEgdeBorder(n,'Top'),t.bottom=this._parseEgdeBorder(n,'Bottom'),t},n._parseEgdeBorder=function(n,t){var i,r=n['border'+t+'Style'];if(r&&r!=='none'&&r!=='hidden'){i={};r=r.toLowerCase();switch(r){case'dotted':i.style=wjcXlsx.BorderStyle.Dotted;break;case'dashed':i.style=wjcXlsx.BorderStyle.Dashed;break;case'double':i.style=wjcXlsx.BorderStyle.Double;break;default:i.style=wjcXlsx.BorderStyle.Thin}i.color=n['border'+t+'Color']}return i},n._parseBorderStyle=function(n,t,i){var r='border'+t+'Style',u='border'+t+'Width';switch(n){case wjcXlsx.BorderStyle.Dotted:case wjcXlsx.BorderStyle.Hair:i[r]='dotted';i[u]='1px';break;case wjcXlsx.BorderStyle.Dashed:case wjcXlsx.BorderStyle.ThinDashDotDotted:case wjcXlsx.BorderStyle.ThinDashDotted:i[r]='dashed';i[u]='1px';break;case wjcXlsx.BorderStyle.MediumDashed:case wjcXlsx.BorderStyle.MediumDashDotDotted:case wjcXlsx.BorderStyle.MediumDashDotted:case wjcXlsx.BorderStyle.SlantedMediumDashDotted:i[r]='dashed';i[u]='2px';break;case wjcXlsx.BorderStyle.Double:i[r]='double';i[u]='3px';break;case wjcXlsx.BorderStyle.Medium:i[r]='solid';i[u]='2px';break;default:i[r]='solid';i[u]='1px'}},n._parseToExcelFontFamily=function(n){var t;return n&&(t=n.split(','),t&&t.length>0&&(n=t[0].replace(/\"|\'/g,''))),n},n._parseToExcelFormula=function(n,t){var u=n.substring(1,n.indexOf('(')).toLowerCase(),i,r;switch(u){case'ceiling':case'floor':n=n.substring(0,n.lastIndexOf(')'))+', 1)';break;case'text':r=n.search(/\,\s*\"/);i=n.substring(r,n.lastIndexOf('\"'));i=wjcXlsx.Workbook._parseCellFormat(i.substring(i.lastIndexOf('\"')+1),t);n=n.substring(0,r)+', \"'+i+'\")'}return n},n._parseToFlexSheetFormula=function(n){var u=n.substring(1).match(/\W+(\w+)\(/),i,f,e,o,t,r;f=u&&u.length===2?u[1]:n.substring(1,n.indexOf('('));e=n.indexOf(f);switch(f.toLowerCase()){case'ceiling':case'floor':n=n.substring(0,n.lastIndexOf(','))+')';break;case'text':i=n.substring(e);t=i.substring(i.indexOf('\"'),i.lastIndexOf('\"'));t=t.substring(t.lastIndexOf('\"')+1);o=t.indexOf('0')>-1?0:'';r=wjcXlsx.Workbook._parseExcelFormat({value:o,style:{format:t}});r=r.replace(/m+/g,function(n){return n.toUpperCase()}).replace(/Y+/g,function(n){return n.toLowerCase()}).replace(/M+:?|:?M+/gi,function(n){return n.indexOf(':')>-1?n.toLowerCase():n});n=n.substring(0,e)+i.substring(0,i.indexOf('\"')+1)+r+n.substring(n.indexOf(t)+t.length)}return n},n._getColumnSetting=function(n,t){var i=n.renderWidth;return i=i||t,{autoWidth:!0,width:i,visible:n.visible,style:{format:n.format?wjcXlsx.Workbook._parseCellFormat(n.format,n.dataType===wjcCore.DataType.Date):'',hAlign:wjcXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(n.getAlignment())),wordWrap:n.wordWrap}}},n._toExcelHAlign=function(n){return(n=n?n.trim().toLowerCase():n,!n)?n:n.indexOf('center')>-1?'center':n.indexOf('right')>-1||n.indexOf('end')>-1?'right':n.indexOf('justify')>-1?'justify':'left'},n._getColumnCount=function(n){for(var u=0,t=0,i,r=0;r<n.length;r++)i=n[r]&&n[r].cells?n[r].cells:[],i&&i.length>0&&(t=i.length,wjcCore.isInt(i[t-1].colSpan)&&i[t-1].colSpan>1&&(t=t+i[t-1].colSpan-1),t>u&&(u=t));return u},n._getRowCount=function(n,t){for(var u=n.length,r=u-1,e=0,f,o,i;e<t;e++)n:for(;r>=0;r--)if(f=n[r],o=f&&f.cells?f.cells:[],i=o[e],i&&(i.value!=null&&i.value!==''||wjcCore.isInt(i.rowSpan)&&i.rowSpan>1)){wjcCore.isInt(i.rowSpan)&&i.rowSpan>1&&r+i.rowSpan>u&&(u=r+i.rowSpan);break n}return u},n._numAlpha=function(n){var t=Math.floor(n/26)-1;return(t>-1?this._numAlpha(t):'')+String.fromCharCode(65+n%26)},n._getItemType=function(n){return n===undefined||n===null||n.value===undefined||n.value===null||isNaN(n.value)?undefined:wjcCore.getType(n.value)},n._setColumn=function(n,t,i){var u,f,e,r=n[t];r?(u=this._getItemType(i),r.dataType!==u&&r.dataType===wjcCore.DataType.Boolean&&u!==wjcCore.DataType.Boolean&&(r.dataType=u),i&&i.value!=null&&i.value!==''&&(f=wjcXlsx.Workbook._parseExcelFormat(i),f&&r.format!==f&&f!=='General'&&(r.format=f)),i&&i.style&&(i.style.hAlign&&(e=wjcXlsx.Workbook._parseHAlignToString(wjcCore.asEnum(i.style.hAlign,wjcXlsx.HAlign))),r.wordWrap=r.wordWrap&&!!i.style.wordWrap),e||u!==wjcCore.DataType.Number||(e='right'),r.hAlign=e):n[t]={dataType:this._getItemType(i),format:wjcXlsx.Workbook._parseExcelFormat(i),hAlign:'',wordWrap:!0}},n._getItemValue=function(n){if(n===undefined||n===null||n.value===undefined||n.value===null)return undefined;var t=n.value;return wjcCore.isNumber(t)&&isNaN(t)?'':t instanceof Date&&isNaN(t.getTime())?'':t},n._getCellStyle=function(n,t,i,r){try{n.grid.cellFactory.updateCell(n,i,r,t);t.className=t.className.replace('wj-state-selected','');t.className=t.className.replace('wj-state-multi-selected','')}catch(u){return null}return window.getComputedStyle(t)},n._extend=function(n,t){var i,r;for(i in t)r=t[i],wjcCore.isObject(r)&&n[i]?wjcCore.copy(n[i],r):n[i]=r;return n},n._checkParentCollapsed=function(n,t){var i=!1;return Object.keys(n).forEach(function(r){n[r]===!0&&i===!1&&!isNaN(t)&&+r<t&&(i=!0)}),i},n._getColSpan=function(n,t,i){for(var u=0,r=t.leftCol;r<=t.rightCol;r++)(!i||i(n.columns[r]))&&u++;return u},n}();exports.FlexGridXlsxConverter=FlexGridXlsxConverter;XlsxFormatItemEventArgs=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;return e._cell=r,e._patternCell=u,e._xlsxCell=f,e}return __extends(t,n),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(n){this._xlsxCell=n},enumerable:!0,configurable:!0}),t.prototype.getFormattedCell=function(){return this._cell||(this._cell=this._patternCell.cloneNode(),this._patternCell.parentElement.appendChild(this._cell),FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.range.row,this.range.col)),this._cell},t}(wjcGrid.CellRangeEventArgs);exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs