/*
    *
    * Wijmo Library 5.20172.334
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";function tryGetModuleWijmoInput(){var n;return(n=window.wijmo)&&n.input}var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wjcCore,wjcSelf,HeadersVisibility,FlexGrid,CellRangeEventArgs,FormatItemEventArgs,CellEditEndingEventArgs,CellType,GridPanel,CellFactory,CellRange,RowColFlags,RowCol,Column,Row,GroupRow,RowColCollection,ColumnCollection,RowCollection,HitTestInfo,AllowMerging,MergeManager,DataMap,SelectionMode,SelectedState,SelMove,_SelectionHandler,KeyAction,_KeyboardHandler,_AR_ALLCELLS,_WJC_DRAGSRC,AllowResizing,AutoSizeMode,AllowDragging,_MouseHandler,_WJC_CHECKBOX,_EditHandler,_AddNewHandler,_NewRowTemplate,_ImeHandler;Object.defineProperty(exports,"__esModule",{value:!0});wjcCore=require("wijmo/wijmo");wjcSelf=require("wijmo/wijmo.grid");window.wijmo=window.wijmo||{};window.wijmo.grid=wjcSelf;wjcCore.culture.FlexGrid=window.wijmo.culture.FlexGrid||{groupHeaderFormat:'{name}: <b>{value}</b> ({count:n0} items)'},function(n){n[n.None=0]="None";n[n.Column=1]="Column";n[n.Row=2]="Row";n[n.All=3]="All"}(HeadersVisibility=exports.HeadersVisibility||(exports.HeadersVisibility={}));FlexGrid=function(n){function t(t,i){var r=n.call(this,t,null,!0)||this,u,f;r._szClient=new wjcCore.Size(0,0);r._ptScrl=new wjcCore.Point(0,0);r._cellPadding=3;r._autoGenCols=!0;r._autoClipboard=!0;r._readOnly=!1;r._indent=14;r._autoSizeMode=AutoSizeMode.Both;r._hdrVis=HeadersVisibility.All;r._alSorting=!0;r._alAddNew=!1;r._alDelete=!1;r._alResizing=AllowResizing.Columns;r._alDragging=AllowDragging.Columns;r._alMerging=AllowMerging.None;r._ssHdr=HeadersVisibility.None;r._shSort=!0;r._shGroups=!0;r._shAlt=!0;r._shErr=!0;r._valEdt=!0;r._deferResizing=!1;r._pSel=!0;r._pOutline=!0;r._vt=0;r.itemsSourceChanged=new wjcCore.Event;r.scrollPositionChanged=new wjcCore.Event;r.selectionChanging=new wjcCore.Event;r.selectionChanged=new wjcCore.Event;r.loadingRows=new wjcCore.Event;r.loadedRows=new wjcCore.Event;r.updatingLayout=new wjcCore.Event;r.updatedLayout=new wjcCore.Event;r.resizingColumn=new wjcCore.Event;r.resizedColumn=new wjcCore.Event;r.autoSizingColumn=new wjcCore.Event;r.autoSizedColumn=new wjcCore.Event;r.draggingColumn=new wjcCore.Event;r.draggingColumnOver=new wjcCore.Event;r.draggedColumn=new wjcCore.Event;r.resizingRow=new wjcCore.Event;r.resizedRow=new wjcCore.Event;r.autoSizingRow=new wjcCore.Event;r.autoSizedRow=new wjcCore.Event;r.draggingRow=new wjcCore.Event;r.draggingRowOver=new wjcCore.Event;r.draggedRow=new wjcCore.Event;r.groupCollapsedChanging=new wjcCore.Event;r.groupCollapsedChanged=new wjcCore.Event;r.sortingColumn=new wjcCore.Event;r.sortedColumn=new wjcCore.Event;r.beginningEdit=new wjcCore.Event;r.prepareCellForEdit=new wjcCore.Event;r.cellEditEnding=new wjcCore.Event;r.cellEditEnded=new wjcCore.Event;r.rowEditStarting=new wjcCore.Event;r.rowEditStarted=new wjcCore.Event;r.rowEditEnding=new wjcCore.Event;r.rowEditEnded=new wjcCore.Event;r.rowAdded=new wjcCore.Event;r.deletingRow=new wjcCore.Event;r.deletedRow=new wjcCore.Event;r.copying=new wjcCore.Event;r.copied=new wjcCore.Event;r.pasting=new wjcCore.Event;r.pasted=new wjcCore.Event;r.pastingCell=new wjcCore.Event;r.pastedCell=new wjcCore.Event;r.formatItem=new wjcCore.Event;r.updatingView=new wjcCore.Event;r.updatedView=new wjcCore.Event;r._mappedColumns=null;u=r.hostElement;wjcCore.isIE()&&(u.style.borderRadius='0px');var e='tabindex',o=u.getAttribute(e),s=r.getTemplate();return r.applyTemplate('wj-control wj-flexgrid wj-content',s,{_root:'root',_eSz:'sz',_eCt:'cells',_fCt:'fcells',_eTL:'tl',_eBL:'bl',_eCHdr:'ch',_eRHdr:'rh',_eCFtr:'cf',_eTLCt:'tlcells',_eBLCt:'blcells',_eCHdrCt:'chcells',_eCFtrCt:'cfcells',_eRHdrCt:'rhcells',_eMarquee:'marquee',_eFocus:'focus'}),wjcCore.setAttribute(u,e,o),f=r._getDefaultRowHeight(),r.deferUpdate(function(){r._rows=new RowCollection(r,f);r._cols=new ColumnCollection(r,f*4);r._hdrRows=new RowCollection(r,f);r._hdrCols=new ColumnCollection(r,Math.round(f*1.25));r._ftrRows=new RowCollection(r,f);r._gpTL=new GridPanel(r,CellType.TopLeft,r._hdrRows,r._hdrCols,r._eTLCt);r._gpCHdr=new GridPanel(r,CellType.ColumnHeader,r._hdrRows,r._cols,r._eCHdrCt);r._gpRHdr=new GridPanel(r,CellType.RowHeader,r._rows,r._hdrCols,r._eRHdrCt);r._gpCells=new GridPanel(r,CellType.Cell,r._rows,r._cols,r._eCt);r._gpBL=new GridPanel(r,CellType.BottomLeft,r._ftrRows,r._hdrCols,r._eBLCt);r._gpCFtr=new GridPanel(r,CellType.ColumnFooter,r._ftrRows,r._cols,r._eCFtrCt);r._hdrRows.push(new Row);r._hdrCols.push(new Column);r._hdrCols[0].align='center';r._cf=new CellFactory;r._keyHdl=new _KeyboardHandler(r);r._mouseHdl=new _MouseHandler(r);r._edtHdl=new _EditHandler(r);r._selHdl=new _SelectionHandler(r);r._addHdl=new _AddNewHandler(r);r._mrgMgr=new MergeManager(r);r._bndSortConverter=r._sortConverter.bind(r);r._bndScroll=r._scroll.bind(r);r.cells.hostElement.setAttribute('role','grid');r.selectionMode=SelectionMode.CellRange;r.initialize(i)}),r.addEventListener(r._root,'scroll',function(){r._updateScrollPosition()&&(r.finishEditing(),r._updateContent(!0))}),r.addEventListener(u,'focus',function(n){if(u.tabIndex>-1){var t=n.target;if(t instanceof HTMLElement&&t.tabIndex<0){r._setFocus(!0);return}}},!0),r}return __extends(t,n),t.prototype._handleResize=function(){this._rcBounds=null;n.prototype._handleResize.call(this)},Object.defineProperty(t.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(n){n!=this._hdrVis&&(this._hdrVis=wjcCore.asEnum(n,HeadersVisibility),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(n){n!=this._stickyHdr&&(this._stickyHdr=wjcCore.asBoolean(n),this._updateStickyHeaders(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(n){this._pSel=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(n){this._pOutline=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_virtualizationThreshold",{get:function(){return this._vt},set:function(n){this._vt=wjcCore.asNumber(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(n){this._autoGenCols=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(n){this._autoClipboard=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnLayout",{get:function(){for(var s,f,i,n,r,e=t._getSerializableProperties(Column),h=new Column,o=[],u=0;u<this.columns.length;u++){for(s=this.columns[u],f={},i=0;i<e.length;i++)n=e[i],r=s[n],r!=h[n]&&wjcCore.isPrimitive(r)&&n!='size'&&(f[n]=r);o.push(f)}return JSON.stringify({columns:o})},set:function(n){var t=JSON.parse(wjcCore.asString(n));if(!t||t.columns==null)throw'Invalid columnLayout data.';this.columns.clear();this.initialize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(n){n!=this._readOnly&&(this._readOnly=wjcCore.asBoolean(n),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),wjcCore.toggleClass(this.hostElement,'wj-state-readonly',this.isReadOnly),this._setAria('readonly',this.isReadOnly?'true':null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imeEnabled",{get:function(){return this._imeHdl!=null},set:function(n){n!=this.imeEnabled&&(this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),n&&(this._imeHdl=new _ImeHandler(this)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(n){this._alResizing=wjcCore.asEnum(n,AllowResizing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(n){this._deferResizing=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(n){this._autoSizeMode=wjcCore.asEnum(n,AutoSizeMode)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(n){this._alSorting=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(n){n!=this._alAddNew&&(this._alAddNew=wjcCore.asBoolean(n),this._addHdl.updateNewRowTemplate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(n){this._addHdl.newRowAtTop=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(n){n!=this._alDelete&&(this._alDelete=wjcCore.asBoolean(n))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(n){n!=this._alMerging&&(this._alMerging=wjcCore.asEnum(n,AllowMerging),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(n){n!=this._ssHdr&&(this._ssHdr=wjcCore.asEnum(n,HeadersVisibility),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMarquee",{get:function(){return!this._eMarquee.style.display},set:function(n){if(n!=this.showMarquee){var t=this._eMarquee.style;t.visibility='collapse';t.display=wjcCore.asBoolean(n)?'':'none';this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){return this._shSort},set:function(n){n!=this._shSort&&(this._shSort=wjcCore.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showGroups",{get:function(){return this._shGroups},set:function(n){n!=this._shGroups&&(this._shGroups=wjcCore.asBoolean(n),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAlternatingRows",{get:function(){return this._shAlt},set:function(n){n!=this._shAlt&&(this._shAlt=wjcCore.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrors",{get:function(){return this._shErr},set:function(n){n!=this._shErr&&(this._shErr=wjcCore.asBoolean(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(n){n!=this.itemValidator&&(this._itemValidator=wjcCore.asFunction(n),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(n){this._valEdt=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(n){n!=this._gHdrFmt&&(this._gHdrFmt=wjcCore.asString(n),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(n){n!=this._alDragging&&(this._alDragging=wjcCore.asEnum(n,AllowDragging),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(n){var t;n!=this._items&&(this._cv&&(t=wjcCore.tryCast(this._cv,wjcCore.CollectionView),t&&t.sortConverter==this._bndSortConverter&&(t.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._items=n,this._cv=this._getCollectionView(n),this._lastCount=0,this._cv&&(this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this),t=wjcCore.tryCast(this._cv,wjcCore.CollectionView),t&&!t.sortConverter&&(t.sortConverter=this._bndSortConverter)),this._bindGrid(!0),this.onItemsSourceChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editableCollectionView",{get:function(){return wjcCore.tryCast(this._cv,'IEditableCollectionView')},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(n){n!=this._childItemsPath&&(wjcCore.assert(n==null||wjcCore.isArray(n)||wjcCore.isString(n),'childItemsPath should be an array or a string.'),this._childItemsPath=n,this._bindGrid(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(n){n!=this.rowHeaderPath&&(n=wjcCore.asString(n),this._rowHdrPath=n?new wjcCore.Binding(n):null,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),t.prototype.getColumn=function(n){return this.columns.getColumn(n)},Object.defineProperty(t.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(n){this.rows.frozen=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(n){this.columns.frozen=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(n){n!=this.cloneFrozenCells&&(this._fzClone=wjcCore.asBoolean(n,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(n){n!=this._sortRowIndex&&(this._sortRowIndex=wjcCore.asNumber(n,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(n){var i=this._root,r=-n.x;if(this.rightToLeft)switch(t._getRtlMode()){case'rev':r=i.scrollWidth-i.clientWidth+n.x;break;case'neg':r=n.x;break;default:r=-n.x}i.scrollLeft=r;i.scrollTop=-n.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlRect",{get:function(){return this._rcBounds||(this._rcBounds=wjcCore.getElementRect(this._root)),this._rcBounds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollSize",{get:function(){return new wjcCore.Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFactory",{get:function(){return this._cf},set:function(n){n!=this._cf&&(this._cf=wjcCore.asType(n,CellFactory,!1),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(n){n!=this._itemFormatter&&(this._itemFormatter=wjcCore.asFunction(n),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.canEditCell=function(n,t){return this._edtHdl._allowEditing(n,t)},t.prototype.getCellData=function(n,t,i){return this.cells.getCellData(n,t,i)},t.prototype.getCellBoundingRect=function(n,t,i){return this.cells.getCellBoundingRect(n,t,i)},t.prototype.setCellData=function(n,t,i,r,u){return r===void 0&&(r=!0),u===void 0&&(u=!0),this.cells.setCellData(n,t,i,r,u)},t.prototype.hitTest=function(n,t){return wjcCore.isNumber(n)&&wjcCore.isNumber(t)&&(n=new wjcCore.Point(n,t)),new HitTestInfo(this,n)},t.prototype.getClipString=function(n){return this._edtHdl.getClipString(n)},t.prototype.setClipString=function(n,t){this._edtHdl.setClipString(n,t)},t.prototype.focus=function(){this._setFocus(!1)},t.prototype.dispose=function(){this.finishEditing(!0);this.itemsSource=null;n.prototype.dispose.call(this)},t.prototype.refresh=function(t){t===void 0&&(t=!0);n.prototype.refresh.call(this,t);this.finishEditing();t&&(this._updateColumnTypes(),this.scrollPosition=this._ptScrl);this.refreshCells(t)},t.prototype.refreshCells=function(n,t,i){this.isUpdating||(n?this._updateLayout():this._updateContent(t,i))},t.prototype.autoSizeColumn=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=4);this.autoSizeColumns(n,n,t,i)},t.prototype.autoSizeColumns=function(n,i,r,u){var e=this;r===void 0&&(r=!1);u===void 0&&(u=4);var o=0,h=r?this.topLeftCells:this.columnHeaders,f=r?this.rowHeaders:this.cells,s=this.viewRange;n=n==null?0:wjcCore.asInt(n);i=i==null?f.columns.length-1:wjcCore.asInt(i);wjcCore.asBoolean(r);wjcCore.asNumber(u);s.row=Math.max(0,s.row-1e3);s.row2=Math.min(s.row2+1e3,this.rows.length-1);this.finishEditing()&&this.deferUpdate(function(){var c,l,r,a;for(wjcCore.setCss(e._eCt,{width:e._gpCells.width}),c=document.createElement('div'),c.setAttribute(t._WJS_MEASURE,'true'),c.style.visibility='hidden',f.hostElement.parentElement.appendChild(c),l=n;l<=i&&l>-1&&l<f.columns.length;l++){if(o=0,e.autoSizeMode&AutoSizeMode.Headers)for(r=0;r<h.rows.length;r++)h.rows[r].isVisible&&(a=e._getDesiredWidth(h,r,l,c),o=Math.max(o,a));if(e.autoSizeMode&AutoSizeMode.Cells)for(r=s.row;r<=s.row2&&r>-1&&r<f.rows.length;r++)f.rows[r].isVisible&&(a=e._getDesiredWidth(f,r,l,c),o=Math.max(o,a));f.columns[l].width=o+u+2}c.parentElement.removeChild(c)})},t.prototype.autoSizeRow=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=0);this.autoSizeRows(n,n,t,i)},t.prototype.autoSizeRows=function(n,i,r,u){var e=this;r===void 0&&(r=!1);u===void 0&&(u=0);var o=0,s=r?this.topLeftCells:this.rowHeaders,f=r?this.columnHeaders:this.cells;r=wjcCore.asBoolean(r);u=wjcCore.asNumber(u);n=n==null?0:wjcCore.asInt(n);i=i==null?f.rows.length-1:wjcCore.asInt(i);this.finishEditing()&&this.deferUpdate(function(){var h,c,r,l;for(wjcCore.setCss(e._eCt,{width:e._gpCells.width}),h=document.createElement('div'),h.setAttribute(t._WJS_MEASURE,'true'),h.style.visibility='hidden',f.hostElement.appendChild(h),c=n;c<=i&&c>-1&&c<f.rows.length;c++){if(o=0,e.autoSizeMode&AutoSizeMode.Headers)for(r=0;r<s.columns.length;r++)s.columns[r].renderSize>0&&(l=e._getDesiredHeight(s,c,r,h),o=Math.max(o,l));if(e.autoSizeMode&AutoSizeMode.Cells)for(r=0;r<f.columns.length;r++)f.columns[r].renderSize>0&&(l=e._getDesiredHeight(f,c,r,h),o=Math.max(o,l));f.rows[c].height=o+u}h.parentElement.removeChild(h)})},Object.defineProperty(t.prototype,"treeIndent",{get:function(){return this._indent},set:function(n){n!=this._indent&&(this._indent=wjcCore.asNumber(n,!1,!0),this.columns.onCollectionChanged())},enumerable:!0,configurable:!0}),t.prototype.collapseGroupsToLevel=function(n){if(this.finishEditing()){var t=this.rows;t.deferUpdate(function(){for(var r,i=0;i<t.length;i++)r=wjcCore.tryCast(t[i],GroupRow),r&&(r.isCollapsed=r.level>=n)})}},Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(n){n!=this.selectionMode&&(this._selHdl.selectionMode=wjcCore.asEnum(n,SelectionMode),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(n){this._selHdl.selection=n},enumerable:!0,configurable:!0}),t.prototype.select=function(n,t){t===void 0&&(t=!0);this._selHdl.select(n,t)},t.prototype.getSelectedState=function(n,t){return this.cells.getSelectedState(n,t,null)},Object.defineProperty(t.prototype,"selectedRows",{get:function(){var t=[],i,n;if(this.selectionMode==SelectionMode.ListBox)for(n=0;n<this.rows.length;n++)this.rows[n].isSelected&&t.push(this.rows[n]);else if(this.rows.length)for(i=this.selection,n=i.topRow;n>-1&&n<=i.bottomRow;n++)t.push(this.rows[n]);return t},set:function(n){var t=this;wjcCore.assert(this.selectionMode==SelectionMode.ListBox,'This property can be set only in ListBox mode.');n=wjcCore.asArray(n);this.deferUpdate(function(){for(var u,f,i=0,r=!0;i<t.rows.length;i++)u=t.rows[i],f=n&&n.indexOf(u)>-1,f&&r&&(r=!1,t.select(i,t.selection.col)),u.isSelected=f})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){for(var n=this.selectedRows,t=0;t<n.length;t++)n[t]=n[t].dataItem;return n},set:function(n){var t=this;wjcCore.assert(this.selectionMode==SelectionMode.ListBox,'This property can be set only in ListBox mode.');n=wjcCore.asArray(n);this.deferUpdate(function(){for(var u,f,i=0,r=!0;i<t.rows.length;i++)u=t.rows[i],f=n&&n.indexOf(u.dataItem)>-1,f&&r&&(r=!1,t.select(i,t.selection.col)),u.isSelected=f})},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(n,t){var r,s;this._maxOffsetY==null&&this._updateLayout();var i=this.scrollPosition,h=this._szClient.width,u=this._szClient.height-this._gpCFtr.rows.getTotalSize(),f=this.cells._getFrozenPos();if(n=wjcCore.asInt(n),n>-1&&n<this._rows.length&&n>=this._rows.frozen){var o=this._rows[n],l=this.cells.height>u?Math.round(o.pos/(this.cells.height-u)*100)/100:0,a=Math.round(this._maxOffsetY*l),e=o.pos-a,c=e+o.renderSize;c>u-i.y&&(i.y=Math.max(-e,u-c));e-f.y<-i.y&&(i.y=-(e-f.y))}return(t=wjcCore.asInt(t),t>-1&&t<this._cols.length&&t>=this._cols.frozen&&(r=this._cols[t],s=r.pos+r.renderSize,s>-i.x+h&&(i.x=Math.max(-r.pos,h-s)),r.pos-f.x<-i.x&&(i.x=-(r.pos-f.x))),!i.equals(this._ptScrl))?(this.scrollPosition=i,!0):!1},t.prototype.isRangeValid=function(n){return n.isValid&&n.bottomRow<this.rows.length&&n.rightCol<this.columns.length},t.prototype.startEditing=function(n,t,i,r){return n===void 0&&(n=!0),this._edtHdl.startEditing(n,t,i,r)},t.prototype.finishEditing=function(n){return n===void 0&&(n=!1),this._edtHdl.finishEditing(n)},Object.defineProperty(t.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(n){n!=this._mrgMgr&&(this._mrgMgr=wjcCore.asType(n,MergeManager,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getMergedRange=function(n,t,i,r){return r===void 0&&(r=!0),this._mrgMgr?this._mrgMgr.getMergedRange(n,t,i,r):null},Object.defineProperty(t.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(n){this._keyHdl._kaTab=wjcCore.asEnum(n,KeyAction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(n){this._keyHdl._kaEnter=wjcCore.asEnum(n,KeyAction)},enumerable:!0,configurable:!0}),t.prototype.onItemsSourceChanged=function(n){this.itemsSourceChanged.raise(this,n)},t.prototype.onScrollPositionChanged=function(n){this.scrollPositionChanged.raise(this,n)},t.prototype.onSelectionChanging=function(n){return this.selectionChanging.raise(this,n),!n.cancel},t.prototype.onSelectionChanged=function(n){this.selectionChanged.raise(this,n)},t.prototype.onLoadingRows=function(n){return this.loadingRows.raise(this,n),!n.cancel},t.prototype.onLoadedRows=function(n){this.loadedRows.raise(this,n)},t.prototype.onUpdatingLayout=function(n){return this.updatingLayout.raise(this,n),!n.cancel},t.prototype.onUpdatedLayout=function(n){this.updatedLayout.raise(this,n)},t.prototype.onResizingColumn=function(n){return this.resizingColumn.raise(this,n),!n.cancel},t.prototype.onResizedColumn=function(n){this.resizedColumn.raise(this,n)},t.prototype.onAutoSizingColumn=function(n){return this.autoSizingColumn.raise(this,n),!n.cancel},t.prototype.onAutoSizedColumn=function(n){this.autoSizedColumn.raise(this,n)},t.prototype.onDraggingColumn=function(n){return this.draggingColumn.raise(this,n),!n.cancel},t.prototype.onDraggingColumnOver=function(n){return this.draggingColumnOver.raise(this,n),!n.cancel},t.prototype.onDraggedColumn=function(n){this.draggedColumn.raise(this,n)},t.prototype.onResizingRow=function(n){return this.resizingRow.raise(this,n),!n.cancel},t.prototype.onResizedRow=function(n){this.resizedRow.raise(this,n)},t.prototype.onAutoSizingRow=function(n){return this.autoSizingRow.raise(this,n),!n.cancel},t.prototype.onAutoSizedRow=function(n){this.autoSizedRow.raise(this,n)},t.prototype.onDraggingRow=function(n){return this.draggingRow.raise(this,n),!n.cancel},t.prototype.onDraggingRowOver=function(n){return this.draggingRowOver.raise(this,n),!n.cancel},t.prototype.onDraggedRow=function(n){this.draggedRow.raise(this,n)},t.prototype.onGroupCollapsedChanging=function(n){return this.groupCollapsedChanging.raise(this,n),!n.cancel},t.prototype.onGroupCollapsedChanged=function(n){this.groupCollapsedChanged.raise(this,n)},t.prototype.onSortingColumn=function(n){return this.sortingColumn.raise(this,n),!n.cancel},t.prototype.onSortedColumn=function(n){this.sortedColumn.raise(this,n)},t.prototype.onBeginningEdit=function(n){return this.beginningEdit.raise(this,n),!n.cancel},t.prototype.onPrepareCellForEdit=function(n){this.prepareCellForEdit.raise(this,n)},t.prototype.onCellEditEnding=function(n){return this.cellEditEnding.raise(this,n),!n.cancel&&!n.stayInEditMode},t.prototype.onCellEditEnded=function(n){this.cellEditEnded.raise(this,n)},t.prototype.onRowEditStarting=function(n){this.rowEditStarting.raise(this,n)},t.prototype.onRowEditStarted=function(n){this.rowEditStarted.raise(this,n)},t.prototype.onRowEditEnding=function(n){this.rowEditEnding.raise(this,n)},t.prototype.onRowEditEnded=function(n){this.rowEditEnded.raise(this,n)},t.prototype.onRowAdded=function(n){return this.rowAdded.raise(this,n),!n.cancel},t.prototype.onDeletingRow=function(n){return this.deletingRow.raise(this,n),!n.cancel},t.prototype.onDeletedRow=function(n){this.deletedRow.raise(this,n)},t.prototype.onCopying=function(n){return this.copying.raise(this,n),!n.cancel},t.prototype.onCopied=function(n){this.copied.raise(this,n)},t.prototype.onPasting=function(n){return this.pasting.raise(this,n),!n.cancel},t.prototype.onPasted=function(n){this.pasted.raise(this,n)},t.prototype.onPastingCell=function(n){return this.pastingCell.raise(this,n),!n.cancel},t.prototype.onPastedCell=function(n){this.pastedCell.raise(this,n)},t.prototype.onFormatItem=function(n){this.formatItem.raise(this,n)},t.prototype.onUpdatingView=function(n){return this.updatingView.raise(this,n),!n.cancel},t.prototype.onUpdatedView=function(n){this.updatedView.raise(this,n)},t.prototype._getShowErrors=function(){if(this.showErrors){if(wjcCore.isFunction(this.itemValidator))return!0;var n=this.collectionView,t=n?n.getError:null;if(wjcCore.isFunction(t))return!0}return!1},t.prototype._getError=function(n,t,i){var u,f,e,s,o,r;if(wjcCore.isFunction(this.itemValidator)){if(n==this.cells)return this.itemValidator(t,i);if(n==this.rowHeaders)for(i=0;i<this.columns.length;i++)if(r=this.itemValidator(t,i),r)return r}if(u=this.collectionView,f=u?u.getError:null,u&&wjcCore.isFunction(f)&&(e=n.rows[t].dataItem,e)){if(n==this.cells)return o=this._getBindingColumn(n,t,this.columns[i]),f(e,o.binding);if(n==this.rowHeaders)for(s=0;s<this.columns.length;s++)if(o=this._getBindingColumn(n,t,this.columns[s]),r=f(e,o.binding),r)return r}return null},t.prototype._setAria=function(n,t){wjcCore.setAttribute(this.cells.hostElement,'aria-'+n,t)},t.prototype._setFocus=function(n){if(this.hostElement&&(n||!this.containsFocus())){var t=wjcCore.getActiveElement(),i='tabindex';this.activeEditor?wjcCore.contains(this.activeEditor,t)||(this._setFocusNoScroll(this.activeEditor),this._eFocus.removeAttribute(i)):this._activeCell?wjcCore.contains(this._activeCell,t)||(this._setFocusNoScroll(this._activeCell),this._eFocus.removeAttribute(i)):wjcCore.contains(this._eFocus,t)||(this._eFocus.tabIndex=0,this._eFocus.focus());this.containsFocus()||(this._eFocus.tabIndex=0,this._eFocus.focus())}},t.prototype._setFocusNoScroll=function(n){var r=this.scrollPosition,t=n.style,u=t.width,f=t.height,i;t.width=t.height='0';n.tabIndex=0;n.focus();t.width=u;t.height=f;this.scrollPosition=r;i=this.hostElement;i.scrollTop=i.scrollLeft=0},t.prototype._getDefaultRowHeight=function(){var u=this.hostElement,n=document.body,t=null,i,f,r;if(n&&!wjcCore.contains(n,u)){for(i=u;i;i=i.parentElement)t=i;t&&n.appendChild(t)}return f=wjcCore.createElement('<div class="wj-cell">123</div>',u),r=f.scrollHeight+2,u.removeChild(f),t&&n.removeChild(t),(r<=6||isNaN(r)||!n)&&(r=28),r},t.prototype._getCollectionView=function(n){return wjcCore.asCollectionView(n)},t.prototype._getDesiredWidth=function(n,t,i,r){var u=this.getMergedRange(n,t,i),f;return this.cellFactory.updateCell(n,t,i,r,u),r.style.width='',f=r.offsetWidth,u&&u.columnSpan>1?f/u.columnSpan:f},t.prototype._getDesiredHeight=function(n,t,i,r){var u=this.getMergedRange(n,t,i),f;return this.cellFactory.updateCell(n,t,i,r,u),r.style.height='',f=r.offsetHeight,u&&u.rowSpan>1?f/u.rowSpan:f},t.prototype._getSortRowIndex=function(){return this._sortRowIndex!=null?this._sortRowIndex:this.columnHeaders.rows.length-1},t.prototype._sortConverter=function(n,t,i,r){var u,o,f,e;if(r){if(this._mappedColumns=null,this.collectionView)for(o=this.collectionView.sortDescriptions,f=0;f<o.length;f++)u=this.getColumn(o[f].property),u&&u.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[u.binding]=u.dataMap);this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(u=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&u.dataMap&&(this._mappedColumns[u.binding]=u.dataMap))}return this._mappedColumns&&(e=this._mappedColumns[n.property],e&&e.sortByDisplayValues&&(i=e.getDisplayValue(i))),i},t.prototype._bindGrid=function(n){var t=this,i;this.deferUpdate(function(){var r,e,o,u,f,s,h,i;if(t._lastCount==0&&t._cv&&t._cv.items&&t._cv.items.length&&(n=!0),r=[],t.preserveSelectedState&&t.selectionMode==SelectionMode.ListBox&&!t.childItemsPath)for(i=0;i<t.rows.length;i++)e=t.rows[i],e.isSelected&&e.dataItem&&r.push(e.dataItem);if(t.preserveOutlineState&&wjcCore.isFunction(window.Map)&&t.rows.maxGroupLevel>-1)for(o=new Map,i=0;i<t.rows.length;i++)u=t.rows[i],u instanceof GroupRow&&u.isCollapsed&&u.dataItem&&(f=u.dataItem,f instanceof wjcCore.CollectionViewGroup&&(f=f._path),o.set(f,!0));if(n&&t.columns.deferUpdate(function(){t._bindColumns()}),t.rows.deferUpdate(function(){t._bindRows()}),s=0,r.length)for(i=0;i<t.rows.length&&s<r.length;i++)r.indexOf(t.rows[i].dataItem)>-1&&(t.rows[i].isSelected=!0,s++);if(t.selectionMode==SelectionMode.ListBox&&s==0)for(h=t.selection,i=h.topRow;i<=h.bottomRow&&i>-1&&i<t.rows.length;i++)t.rows[i].isSelected=!0;o&&t.rows.deferUpdate(function(){for(var r,n,i=0;i<t.rows.length;i++)r=t.rows[i],r instanceof GroupRow&&(n=r.dataItem,n instanceof wjcCore.CollectionViewGroup&&(n=n._path),o.get(n)&&(r.isCollapsed=!0))});!t._lastCount&&t._cv&&t._cv.items&&(t._lastCount=t._cv.items.length)});this.rows.length||(i=this._selHdl.selection,i.row=i.row2=-1);this.collectionView&&this._cvCurrentChanged(this.collectionView,wjcCore.EventArgs.empty)},t.prototype._cvCollectionChanged=function(n,t){var i,r;if(this.autoGenerateColumns&&this.columns.length==0){this._bindGrid(!0);return}if(this.childItemsPath&&t.action!=wjcCore.NotifyCollectionChangedAction.Change){this._bindGrid(!1);return}switch(t.action){case wjcCore.NotifyCollectionChangedAction.Change:this.invalidate();return;case wjcCore.NotifyCollectionChangedAction.Add:if(t.index==this.collectionView.items.length-1){i=this.rows.length;this.rows[i-1]instanceof _NewRowTemplate&&i--;this.rows.insert(i,new Row(t.item));return}wjcCore.assert(!1,'added item should be the last one.');break;case wjcCore.NotifyCollectionChangedAction.Remove:if(r=this._findRow(t.item),r>-1){this.rows.removeAt(r);this._cvCurrentChanged(n,t);return}wjcCore.assert(!1,'removed item not found in grid.')}this._bindGrid(!1)},t.prototype._cvCurrentChanged=function(){var n,t,i;this.collectionView&&this.selectionMode!=SelectionMode.None&&(n=this.selection,t=n.row>-1&&n.row<this.rows.length?this.rows[n.row].dataItem:null,t instanceof wjcCore.CollectionViewGroup&&(t=null),t!=this.collectionView.currentItem&&(this.childItemsPath&&this.editableCollectionView&&this.editableCollectionView.currentAddItem||(i=this._getRowIndex(this.collectionView.currentPosition),i==n.row&&this.childItemsPath||(n.row=n.row2=i,this.select(n,!1),this.selectionMode&&this.scrollIntoView(n.row,-1)))))},t.prototype._getRowIndex=function(n){var r,t,i;if(this.collectionView){if(n>-1){for(r=this.collectionView.items[n];n<this.rows.length;n++)if(this.rows[n].dataItem===r)return n;return-1}return this.rows.length==1&&this.rows[0]instanceof _NewRowTemplate?0:(t=this.selection.row,i=t>-1?this.rows[t]:null,i&&(i instanceof GroupRow||i.dataItem==null)?t:-1)}return this.selection.row},t.prototype._getCvIndex=function(n){if(n>-1&&this.collectionView){var t=this.rows[n].dataItem;for(n=Math.min(n,this.collectionView.items.length);n>-1;n--)if(this.collectionView.items[n]===t)return n}return-1},t.prototype._findRow=function(n){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==n)return t;return-1},t.prototype._updateLayout=function(){var y=new wjcCore.CancelEventArgs,h,f,c,o,v,e;if(this.onUpdatingLayout(y)){var n=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,u=this._ftrRows.getTotalSize(),s=this._rows.getTotalSize()+u;s<1&&(s=1);this._heightBrowser=Math.min(s,t._getMaxSupportedCssHeight());this._maxOffsetY=Math.max(0,s-this._heightBrowser);this.cells.hostElement&&(h=wjcCore.createElement('<div class="wj-cell"></div>',this.cells.hostElement),e=getComputedStyle(h),this._cellPadding=parseInt(this.rightToLeft?e.paddingRight:e.paddingLeft),h.parentElement.removeChild(h));f=this._heightBrowser+i-u;this.rightToLeft?(wjcCore.setCss(this._eTL,{right:0,top:0,width:n,height:i}),wjcCore.setCss(this._eCHdr,{right:n,top:0,height:i}),wjcCore.setCss(this._eRHdr,{right:0,top:i,width:n}),wjcCore.setCss(this._eCt,{right:n,top:i,width:this._gpCells.width,height:this._heightBrowser}),wjcCore.setCss(this._fCt,{right:n,top:i}),wjcCore.setCss(this._eBL,{right:0,top:f,width:n,height:u}),wjcCore.setCss(this._eCFtr,{right:n,top:f,height:u})):(wjcCore.setCss(this._eTL,{left:0,top:0,width:n,height:i}),wjcCore.setCss(this._eCHdr,{left:n,top:0,height:i}),wjcCore.setCss(this._eRHdr,{left:0,top:i,width:n}),wjcCore.setCss(this._eCt,{left:n,top:i,width:this._gpCells.width,height:this._heightBrowser}),wjcCore.setCss(this._fCt,{left:n,top:i}),wjcCore.setCss(this._eBL,{left:0,top:f,width:n,height:u}),wjcCore.setCss(this._eCFtr,{left:n,top:f,height:u}));this._stickyHdr&&this._updateStickyHeaders();wjcCore.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:this.frozenRows||this.frozenColumns?'3':''});var r=this._root,l=r.offsetWidth-r.clientWidth,a=r.offsetHeight-r.clientHeight;wjcCore.setCss(this._eSz,{width:n+l+this._gpCells.width,height:i+a+this._heightBrowser});c=null;this.columns._updateStarSizes(r.clientWidth-n)&&(c=r.clientWidth,wjcCore.setCss(this._eCt,{width:this._gpCells.width}));this._szClient=new wjcCore.Size(r.clientWidth-n,r.clientHeight-i);this._rcBounds=null;this._updateScrollHandler();this._updateContent(!1);l=r.offsetWidth-r.clientWidth;a=r.offsetHeight-r.clientHeight;wjcCore.setCss(this._eSz,{width:n+l+this._gpCells.width,height:i+a+this._heightBrowser});o=this.hostElement;o&&(v=o.offsetHeight+'px',e=getComputedStyle(o),e.maxHeight==v&&e.boxSizing!='content-box'&&(o.style.height=v));this._szClient=new wjcCore.Size(r.clientWidth-n,r.clientHeight-i);c&&c!=r.clientWidth&&this.columns._updateStarSizes(r.clientWidth-n)&&(wjcCore.setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1));wjcCore.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width});wjcCore.setCss([this._eRHdr,this._fCt],{height:this._szClient.height});u&&(f=Math.min(f,this._szClient.height+i-u),wjcCore.setCss([this._eBL,this._eCFtr],{top:f}));this.onUpdatedLayout(y)}},t.prototype._updateStickyHeaders=function(){var r=!1,e=0,u,n,i,f;if(this._stickyHdr){for(u=0,n=null,i=this.hostElement;i;i=i.parentElement)f=i.getBoundingClientRect(),n==null&&(n=f.top),u=Math.max(u,f.top);n=Math.max(0,u-n-1);e=-n;r=n>0}this._eTL.style.top=this._eCHdr.style.top=r?-e+'px':'';wjcCore.toggleClass(this._eTL,t._WJS_STICKY,r);wjcCore.toggleClass(this._eCHdr,t._WJS_STICKY,r)},t.prototype._updateScrollHandler=function(){var n=this._stickyHdr||this._clipToScreen();n!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=n,n?this.addEventListener(window,'scroll',this._bndScroll,!0):this.removeEventListener(window,'scroll',this._bndScroll,!0))},t.prototype._clipToScreen=function(){var n=this.hostElement;return this.rows.length>t._MIN_VIRT_ROWS&&n.parentElement==document.body&&n.clientHeight==n.scrollHeight},t.prototype._scroll=function(n){var t=this;wjcCore.contains(n.target,this.hostElement)&&(this._clipToScreen()&&(this._afScrl&&cancelAnimationFrame(this._afScrl),this._afScrl=requestAnimationFrame(function(){t.finishEditing();t._updateContent(!0);t._afScrl=null})),this._stickyHdr&&(this._toSticky&&cancelAnimationFrame(this._toSticky),this._toSticky=requestAnimationFrame(function(){t._toSticky=null;var n=new wjcCore.CancelEventArgs;if(t.onUpdatingLayout(n)){t._updateStickyHeaders();t.onUpdatedLayout(n)}})))},t.prototype._updateScrollPosition=function(){var n=this._root,u=n.scrollTop,i=n.scrollLeft,r;return(this.rightToLeft&&t._getRtlMode()=='rev'&&(i=n.scrollWidth-n.clientWidth-i),r=new wjcCore.Point(-Math.abs(i),-u),!this._ptScrl.equals(r))?(this._ptScrl=r,this.onScrollPositionChanged(),!0):!1},t.prototype._updateContent=function(n,t){var s=wjcCore.getActiveElement(),r=wjcCore.contains(this.hostElement,s)?s:null,e=this._activeCell,h=new wjcCore.CancelEventArgs,c,i,o,u;if(this.onUpdatingView(h)){if(this._offsetY=0,this._heightBrowser>this._szClient.height&&(c=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100,this._offsetY=Math.round(this._maxOffsetY*c)),this._updateScrollPosition(),i=this._gpCells._updateContent(n,t,this._offsetY),this._hdrVis&HeadersVisibility.Column&&(!t||this._ssHdr&HeadersVisibility.Column)&&this._gpCHdr._updateContent(n,t,0),this._hdrVis&HeadersVisibility.Row&&(!t||this._ssHdr&HeadersVisibility.Row)&&this._gpRHdr._updateContent(n,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(n,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(n,t,0),this._gpCFtr._updateContent(n,t,0)),this.showMarquee)if(o=this._selHdl.selection,u=this._eMarquee,this.isRangeValid(o)){var f=this._getMarqueeRect(o),l=u.firstChild,a=u.offsetWidth-l.offsetWidth,v=u.offsetHeight-l.offsetHeight;wjcCore.setCss(u,{left:f.left+this.cells.hostElement.offsetLeft-a/2,top:f.top+this.cells.hostElement.offsetTop-v/2,width:f.width+a,height:f.height+v,visibility:f.width>0&&f.height>0?'':'collapse'})}else u.style.visibility='collapse';this._useFrozenDiv()&&(this._updateFrozenCells(t),i&&i.classList.contains('wj-frozen')&&(i=null));this._activeCell=i;r&&(r!=this._root&&r!=this._eFocus&&wjcCore.contains(this.hostElement,r)&&!wjcCore.contains(this.cells.hostElement,r)?r.focus():this._setFocus(!0));!r&&i&&(i.tabIndex=0);e&&e!=i&&e.removeAttribute('tabindex');this._rcBounds=null;this.onUpdatedView(h)}},t.prototype._useFrozenDiv=function(){return wjcCore.isBoolean(this._fzClone)?this._fzClone:wjcCore.isIE()||wjcCore.isFirefox()||wjcCore.isMobile()},t.prototype._updateFrozenCells=function(n){var i,t,r;if(this.frozenRows||this.frozenColumns){if(i=this._eCt.querySelectorAll('.wj-frozen'),n&&this._fCt.children.length==i.length){for(t=0;t<i.length;t++)this._fCt.children[t].className=i[t].className;return}if(wjcCore.setText(this._fCt,null),!this.activeEditor)for(t=0;t<i.length;t++)r=i[t].cloneNode(!0),r.style.pointerEvents='auto',this._fCt.appendChild(r)}else wjcCore.setText(this._fCt,null)},t.prototype._getMarqueeRect=function(n){var e=this.getMergedRange(this.cells,n.topRow,n.leftCol)||new CellRange(n.topRow,n.leftCol),o=this.getMergedRange(this.cells,n.bottomRow,n.rightCol)||new CellRange(n.bottomRow,n.rightCol),t=this.cells.getCellBoundingRect(e.topRow,e.leftCol,!0),r=this.cells.getCellBoundingRect(o.bottomRow,o.rightCol,!0),f,u,i;return this.rows.frozen&&(f=Math.min(this.rows.length,this.rows.frozen),i=this.cells.getCellBoundingRect(f-1,0,!0),n.topRow>=f&&t.top<i.bottom&&(t.top=i.bottom),n.bottomRow>=f&&r.bottom<i.bottom&&(r.height=i.bottom-r.top)),this.columns.frozen&&(u=Math.min(this.columns.length,this.columns.frozen),i=this.cells.getCellBoundingRect(0,u-1,!0),this.rightToLeft?(n.leftCol>=u&&t.right>i.left&&(t.left=i.left-t.width),n.rightCol>=u&&r.left>i.left&&(r.left=i.left)):(n.leftCol>=u&&t.left<i.right&&(t.left=i.right),n.rightCol>=u&&r.right<i.right&&(r.width=i.right-r.left))),this.rightToLeft?new wjcCore.Rect(r.left,t.top,t.right-r.left,r.bottom-t.top):new wjcCore.Rect(t.left,t.top,r.right-t.left,r.bottom-t.top)},t.prototype._bindColumns=function(){for(var r,u,f,n,e,t=0;t<this.columns.length;t++)n=this.columns[t],n._getFlag(RowColFlags.AutoGenerated)&&(this.columns.removeAt(t),t--);var s=this.collectionView,i=s?s.sourceCollection:null,o=i&&i.length?i[0]:null;if(o&&this.autoGenerateColumns)for(r in o)for(u=null,f=0;f<i.length&&f<1e3&&u==null;f++)u=i[f][r],wjcCore.isPrimitive(u)&&(n=new Column,n._setFlag(RowColFlags.AutoGenerated,!0),n.binding=n.name=r,n.header=wjcCore.toHeaderCase(r),n.dataType=wjcCore.getType(u),n.dataType==wjcCore.DataType.Number&&(n.width=80),e=Object.getOwnPropertyDescriptor(o,r),!e||e.writable||wjcCore.isFunction(e.set)||n._setFlag(RowColFlags.ReadOnly,!0),this.columns.push(n));this._updateColumnTypes()},t.prototype._updateColumnTypes=function(){var r=this.collectionView,u,i,t,n;if(wjcCore.hasItems(r))for(u=r.items[0],i=this.columns,t=0;t<i.length;t++)n=i[t],n.dataType==null&&n._binding&&(n.dataType=wjcCore.getType(n._binding.getValue(u)))},t.prototype._getBindingColumn=function(n,t,i){return i},t.prototype._getRowHeaderPath=function(){return this._rowHdrPath},t.prototype._bindRows=function(){var u=new wjcCore.CancelEventArgs,t,i,r,n;if(this.onLoadingRows(u)){if(this.rows.clear(),t=this.collectionView,t&&t.items)if(i=t.items,r=t.groups,this.childItemsPath)for(n=0;n<i.length;n++)this._addNode(i,n,0);else if(r!=null&&r.length>0&&this.showGroups)for(n=0;n<r.length;n++)this._addGroup(r[n]);else for(n=0;n<i.length;n++)this._addBoundRow(i,n);this.onLoadedRows(u)}},t.prototype._addBoundRow=function(n,t){this.rows.push(new Row(n[t]))},t.prototype._addNode=function(n,t,i){var u=new GroupRow,f=this.childItemsPath,s=wjcCore.isArray(f)?f[i]:f,o=n[t],e=o[s],r;if(u.dataItem=o,u.level=i,this.rows.push(u),wjcCore.isArray(e))for(r=0;r<e.length;r++)this._addNode(e,r,i+1)},t.prototype._addGroup=function(n){var i=new GroupRow,r,t;if(i.level=n.level,i.dataItem=n,this.rows.push(i),n.isBottomLevel)for(r=n.items,t=0;t<r.length;t++)this._addBoundRow(r,t);else for(t=0;t<n.groups.length;t++)this._addGroup(n.groups[t])},t._getSerializableProperties=function(n){var f=[],u,i,t,r;for(n=n.prototype;n!=Object.prototype;n=Object.getPrototypeOf(n))for(u=Object.getOwnPropertyNames(n),i=0;i<u.length;i++)t=u[i],r=Object.getOwnPropertyDescriptor(n,t),r&&r.set&&r.get&&t[0]!='_'&&!t.match(/disabled|required/)&&f.push(t);return f},t.prototype._copy=function(n,t){var r,i,u;if(n=='columns'){for(this.columns.clear(),r=wjcCore.asArray(t),i=0;i<r.length;i++)u=new Column,wjcCore.copy(u,r[i]),this.columns.push(u);return!0}return!1},t.prototype._isInputElement=function(n){if(n instanceof HTMLElement){if(n.contentEditable=='true')return!0;var t=n.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1},t.prototype._wantsInput=function(n){return!this.activeEditor&&this._isInputElement(n)&&!n.classList.contains('wj-grid-ime')},t._getMaxSupportedCssHeight=function(){var n;if(!t._maxCssHeight){var r=1e6,i=document.createElement('div');for(i.style.visibility='hidden',document.body.appendChild(i),n=r;n<=6e7;n+=5e5){if(i.style.height=n+'px',i.offsetHeight!=n)break;r=n}document.body.removeChild(i);t._maxCssHeight=r}return t._maxCssHeight},t._getRtlMode=function(){var n,i,r;return t._rtlMode||(n=wjcCore.createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"><\/div><\/div>'),document.body.appendChild(n),i=n.scrollLeft,n.scrollLeft=-1e3,r=n.scrollLeft,document.body.removeChild(n),t._rtlMode=r<0?'neg':i>0?'rev':'std'),t._rtlMode},t}(wjcCore.Control);FlexGrid._WJS_STICKY='wj-state-sticky';FlexGrid._WJS_MEASURE='wj-state-measuring';FlexGrid._WJS_UPDATING='wj-state-updating';FlexGrid._MIN_VIRT_ROWS=200;FlexGrid.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="focus" aria-hidden="true" style="position:fixed;opacity:0;pointer-events:none;left:-10px;top:-10px"><\/div><div wj-part="root" style="position:absolute;width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch;max-width:inherit;max-height:inherit"><div wj-part="cells" class="wj-cells" style="position:absolute"><\/div><div wj-part="marquee" aria-hidden="true" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"><\/div><\/div><\/div><div wj-part="fcells" aria-hidden="true" class="wj-cells" style="position:absolute;pointer-events:none;overflow:hidden"><\/div><div wj-part="rh" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="rhcells" class="wj-rowheaders" style="position:relative"><\/div><\/div><div wj-part="cf" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="cfcells" class="wj-colfooters" style="position:relative"><\/div><\/div><div wj-part="ch" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="chcells" class="wj-colheaders" style="position:relative"><\/div><\/div><div wj-part="bl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="blcells" class="wj-bottomleft" style="position:relative"><\/div><\/div><div wj-part="tl" aria-hidden="true" style="position:absolute;overflow:hidden;outline:none"><div wj-part="tlcells" class="wj-topleft" style="position:relative"><\/div><\/div><div wj-part="sz" aria-hidden="true" style="position:relative;visibility:hidden"><\/div><\/div>';exports.FlexGrid=FlexGrid;CellRangeEventArgs=function(n){function t(t,i,r){var u=n.call(this)||this;return u._p=wjcCore.asType(t,GridPanel),u._rng=wjcCore.asType(i,CellRange),u._data=r,u}return __extends(t,n),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(n){this._data=n},enumerable:!0,configurable:!0}),t}(wjcCore.CancelEventArgs);exports.CellRangeEventArgs=CellRangeEventArgs;FormatItemEventArgs=function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u._cell=wjcCore.asType(r,HTMLElement),u}return __extends(t,n),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);exports.FormatItemEventArgs=FormatItemEventArgs;CellEditEndingEventArgs=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(n){this._stayInEditMode=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);exports.CellEditEndingEventArgs=CellEditEndingEventArgs,function(n){n[n.None=0]="None";n[n.Cell=1]="Cell";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.TopLeft=4]="TopLeft";n[n.ColumnFooter=5]="ColumnFooter";n[n.BottomLeft=6]="BottomLeft"}(CellType=exports.CellType||(exports.CellType={}));GridPanel=function(){function n(t,i,r,u,f){this._offsetY=0;this._g=wjcCore.asType(t,FlexGrid);this._ct=wjcCore.asInt(i);this._rows=wjcCore.asType(r,RowCollection);this._cols=wjcCore.asType(u,ColumnCollection);this._e=wjcCore.asType(f,HTMLElement);this._vrb=new CellRange;n._evtBlur||(n._evtBlur=document.createEvent('HTMLEvents'),n._evtBlur.initEvent('blur',!0,!1))}return Object.defineProperty(n.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),n.prototype.getCellData=function(n,t,i){var f=this._rows[wjcCore.asNumber(n,!1,!0)],e,u=null,r,o,s,h;if(wjcCore.isString(t)&&(t=this._cols.indexOf(t),t<0))throw'Invalid column name or binding.';if(e=this._cols[wjcCore.asNumber(t,!1,!0)],r=this._g?this._g._getBindingColumn(this,n,e):e,!r.binding||!f.dataItem||f.dataItem instanceof wjcCore.CollectionViewGroup?f._ubv&&(u=f._ubv[e._hash]):u=r._binding.getValue(f.dataItem),u==null)switch(this._ct){case CellType.ColumnHeader:(n==this._rows.length-1||r!=e)&&(u=r.header);break;case CellType.ColumnFooter:r.aggregate!=wjcCore.Aggregate.None&&f instanceof GroupRow&&(o=this._g.collectionView,o&&(s=wjcCore.tryCast(o,wjcCore.CollectionView),u=s?s.getAggregate(r.aggregate,r.binding):wjcCore.getAggregate(r.aggregate,o.items,r.binding)));break;case CellType.Cell:r.aggregate!=wjcCore.Aggregate.None&&f instanceof GroupRow&&(h=wjcCore.tryCast(f.dataItem,wjcCore.CollectionViewGroup),h&&(u=h.getAggregate(r.aggregate,r.binding,this._g.collectionView)))}return i&&(this.cellType==CellType.Cell&&r.dataMap&&(u=r.dataMap.getDisplayValue(u)),u=u!=null?wjcCore.Globalize.format(u,r.format):''),u},n.prototype.setCellData=function(n,t,i,r,u){var e,l,f,s,a,o,v,c,w;if(r===void 0&&(r=!0),u===void 0&&(u=!0),e=this._rows[wjcCore.asNumber(n,!1,!0)],wjcCore.isString(t)&&(t=this._cols.indexOf(t),t<0))throw'Invalid column name or binding.';if(l=this._cols[wjcCore.asNumber(t,!1,!0)],f=this._g?this._g._getBindingColumn(this,n,l):l,this._ct==CellType.Cell){if(f.dataMap&&i!=null&&(f.isRequired||i!==''&&i!=null))if(s=f.dataMap,a=s.getKeyValue(i),a==null){if(!s.isEditable||s.displayMemberPath!=s.selectedValuePath)return!1}else i=a;if(o=wjcCore.DataType.Object,f.dataType?o=f.dataType:(v=this.getCellData(n,t,!1),o=wjcCore.getType(v)),wjcCore.isBoolean(f.isRequired))if(f.isRequired||i!==''&&i!==null){if(f.isRequired&&(i===''||i===null))return!1}else i=null,r=!1;if(r&&(i=wjcCore.changeType(i,o,f.format),o!=wjcCore.DataType.Object&&wjcCore.getType(i)!=o))return!1}if(e.dataItem&&f.binding){var y=f._binding,h=e.dataItem,p=y.getValue(h);if(i!==p&&!wjcCore.DateTime.equals(i,p)&&(y.setValue(h,i),c=this._g.collectionView,c instanceof wjcCore.CollectionView&&h!=c.currentEditItem)){w=new wjcCore.NotifyCollectionChangedEventArgs(wjcCore.NotifyCollectionChangedAction.Change,h,c.items.indexOf(h));c.onCollectionChanged(w)}}else e._ubv||(e._ubv={}),e._ubv[l._hash]=i;return u&&this._g&&this._g.invalidate(),!0},n.prototype.getCellBoundingRect=function(n,t,i){var e=this.rows[n],o=this.columns[t],r=new wjcCore.Rect(o.pos,e.pos,o.renderSize,e.renderSize),u,f;return this._g.rightToLeft&&(r.left=this.hostElement.clientWidth-r.right,wjcCore.isIE()||wjcCore.isFirefox()||(u=this.hostElement.parentElement,r.left-=u.offsetWidth-u.clientWidth)),i||(f=this.hostElement.getBoundingClientRect(),r.left+=f.left,r.top+=f.top-this._offsetY),n<this.rows.frozen&&(r.top-=this._g.scrollPosition.y),t<this.columns.frozen&&(r.left-=this._g.scrollPosition.x*(this._g.rightToLeft?-1:1)),r},n.prototype.getCellElement=function(t,i){for(var e,h,u,o,r,s=this.hostElement.children,c=Math.min(t+2,s.length),f=0;f<c;f++)for(e=s[f].children,h=Math.min(i+1,e.length),u=0;u<h;u++)if(o=e[u],r=o[n._INDEX_KEY],r&&(r.row==t&&r.col==i||r.rng&&r.rng.contains(t,i)))return o;return null},n.prototype.getSelectedState=function(n,t,i){var u=this._g,f=u.selectionMode,r=u._selHdl.selection;if(f!=SelectionMode.None)switch(this._ct){case CellType.Cell:if(i||(i=u.getMergedRange(this,n,t)),i){if(i.contains(r.row,r.col))return u.showMarquee?SelectedState.None:SelectedState.Cursor;if(i.intersects(r))return SelectedState.Selected}return r.row==n&&r.col==t?u.showMarquee?SelectedState.None:SelectedState.Cursor:u.rows[n].isSelected||u.columns[t].isSelected?SelectedState.Selected:(r=u._selHdl._adjustSelection(r),f==SelectionMode.ListBox)?SelectedState.None:r.containsRow(n)&&r.containsColumn(t)?SelectedState.Selected:SelectedState.None;case CellType.ColumnHeader:if(u.showSelectedHeaders&HeadersVisibility.Column&&(u.columns[t].isSelected||r.containsColumn(t)||r.intersectsColumn(i))&&(i&&(n=i.bottomRow),n==this.rows.length-1))return SelectedState.Selected;break;case CellType.RowHeader:if(u.showSelectedHeaders&HeadersVisibility.Row&&(u.rows[n].isSelected||r.containsRow(n)||r.intersectsRow(i))&&(i&&(t=i.rightCol),t==this.columns.length-1))return SelectedState.Selected}return SelectedState.None},Object.defineProperty(n.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0}),n.prototype._getOffsetY=function(){return this._offsetY},n.prototype._updateContent=function(t,i,r){var c=this._g,e=this._e,s=this._rows,l=this._cols,a=this._ct,v,y,o,u,b,p,k,w,h,f;if((a==CellType.ColumnHeader||a==CellType.ColumnFooter||a==CellType.RowHeader)&&(v=c._ptScrl,y=e.style,a==CellType.RowHeader?y.top=v.y+'px':c.rightToLeft?y.right=v.x+'px':y.left=v.x+'px'),this._offsetY!=r&&(t=!1,this._offsetY=r),o=this._getViewRange(),s.length<=c._virtualizationThreshold?u=new CellRange(0,0,s.length-1,l.length-1):(u=o.clone(),u.isValid&&c.isTouching&&(b=6,u.row=Math.max(o.row-b,s.frozen),u.row2=Math.min(o.row2+b,s.length-1),u.col=Math.max(o.col-1,l.frozen),u.col2=Math.min(o.col2+1,l.length-1))),t&&!i&&this._vrb.contains(o)&&!s.frozen&&!l.frozen)return this._activeCell;if(t&&u.equals(this._vrb)||(i=!1),!t){var d=wjcCore.getActiveElement(),g=wjcCore.contains(e,d)?d:null,nt=c.cellFactory;for(p=0;p<e.childElementCount;p++)for(k=e.children[p],w=0;w<k.childElementCount;w++)nt.disposeCell(k.children[w]);wjcCore.setText(e,null);g&&g.dispatchEvent(n._evtBlur)}for(t&&!i&&this._ct!=CellType.TopLeft&&this._reorderCells(u,this._vrb),this._activeCell=null,this._vru=o,this._vrb=u,h=0,this._ct==CellType.Cell&&(h=this._renderColHdrRow(u,i)),f=0;f<s.frozen&&f<s.length;f++)h=this._renderRow(f,u,i,h);for(f=u.topRow;f<=u.bottomRow&&f>-1;f++)h=this._renderRow(f,u,i,h);while(e.childElementCount>h)e.removeChild(e.lastChild);return this._activeCell},n.prototype._reorderCells=function(n,t){var r,f,h;if(!(this._rows.frozen>0)&&!(this._cols.frozen>0)&&n.columnSpan==t.columnSpan&&n.rowSpan==t.rowSpan&&t.isValid&&n.isValid&&n.intersects(t)&&n.row!=t.row){var i=n.row-t.row,c=Math.max(1,n.rowSpan-1),u=this._e;if(i!=0&&Math.abs(i)<c){if(r=this._ct==CellType.Cell?1:0,f=u.childElementCount,i>0){var s=r,e=Math.min(r+i,f-1),o=this._createRange(s,e);o&&e<f-1&&u.appendChild(o.extractContents())}if(i<0){var e=f,s=Math.max(r,e+i),o=this._createRange(s,e);o&&s>r&&(h=u.children[r],u.insertBefore(o.extractContents(),h))}}}},n.prototype._createRange=function(n,t){var i,r=this._e.childElementCount;return t>n&&t<=r&&n>-1&&(i=document.createRange(),i.setStart(this._e,n),i.setEnd(this._e,t)),i},n.prototype._renderColHdrRow=function(n,t){var u=this._e.children[0],r,f,i;for(u||(u=wjcCore.createElement('<div class="wj-row" role="row" tabindex="-1"></div>',this._e)),r=0,f=this._g._getRowHeaderPath(),f&&(r=this._renderRowHdrCell(u,-1,f.path)),i=0;i<this.columns.frozen&&i<this.columns.length;i++)r=this._renderColHdrCell(u,i,n,t,r);for(i=n.leftCol;i<=n.rightCol&&i>-1;i++)r=this._renderColHdrCell(u,i,n,t,r);return 1},n.prototype._renderColHdrCell=function(t,i,r,u,f){var o=this.columns[i],e,h,s,c;if(o.renderSize<=0)return f;if(e=t.children[f],e||(e=wjcCore.createElement('<div class="wj-cell" role="columnheader" tabindex="-1"></div>',t)),u||(e.textContent=this.columns[i].header,wjcCore.setCss(e,{left:o.pos,width:o.renderSize,top:-32e3,height:.1,overflow:'hidden'})),h=this.grid,h.allowSorting){s='none';c=h._getBindingColumn(this,0,o);switch(c.currentSort){case'+':s='ascending';break;case'-':s='descending'}wjcCore.setAttribute(e,'aria-sort',s)}return e[n._INDEX_KEY]={row:-1,col:i,panel:this},f+1},n.prototype._renderRowHdrCell=function(t,i,r){var u=t.children[0];return u||(u=wjcCore.createElement('<div class="wj-cell" tabindex="-1"></div>',t)),wjcCore.setAttribute(u,'role',i<0?'columnheader':'rowheader'),wjcCore.setText(u,r?r.toString():''),wjcCore.setCss(u,{left:-32e3,top:-32e3,width:.1,height:.1,overflow:'hidden'}),u[n._INDEX_KEY]={row:i,col:-1,panel:this},1},n.prototype._renderRow=function(n,t,i,r){var s=this.rows[n],h=s.renderSize,u,e,o,f;if(h<=0)return r;for(u=this._e.children[r],u||(u=wjcCore.createElement('<div class="wj-row" tabindex="-1"></div>',this._e),this._ct==CellType.Cell&&u.setAttribute('role','row')),e=0,this._ct==CellType.Cell&&(o=this._g._getRowHeaderPath(),o&&(e=this._renderRowHdrCell(u,n,o.getValue(s.dataItem)))),f=0;f<this.columns.frozen&&f<this.columns.length;f++)e=this._renderCell(u,n,f,t,i,e);for(f=t.leftCol;f<=t.rightCol&&f>-1;f++)e=this._renderCell(u,n,f,t,i,e);while(u.childElementCount>e)u.removeChild(u.lastElementChild);return r+1},n.prototype._renderCell=function(t,i,r,u,f,e){var a=this._g,s=a.getMergedRange(this,i,r),h,v,l,c;if(s){for(h=Math.max(u.row,s.row);h<i;h++)if(this.rows[h].isVisible)return e;for(h=Math.max(u.col,s.col);h<r;h++)if(this.columns[h].isVisible)return e}if(v=this.columns[r],v.renderSize<=0&&(!s||s.getRenderSize(this).width<=0))return e;l=!1;this.cellType==CellType.Cell&&(c=a._selHdl.selection,l=c.row==i&&c.col==r||s&&s.contains(c.row,c.col));var o=t.children[e],y=this.getSelectedState(i,r,s),p=SelectedState;return o&&f?(wjcCore.toggleClass(o,'wj-state-selected',y==p.Cursor),wjcCore.toggleClass(o,'wj-state-multi-selected',y==p.Selected),l&&(this._activeCell=o),e+1):(o||(o=document.createElement('div'),o.tabIndex=-1,this._ct==CellType.Cell&&o.setAttribute('role','gridcell'),t.appendChild(o)),l&&(this._activeCell=o),a.cellFactory.updateCell(this,i,r,o,s),o[n._INDEX_KEY]={row:i,col:r,rng:s,panel:this},e+1)},n.prototype._getViewRange=function(){var u=this._g,h=u._ptScrl,t=this._rows,i=this._cols,n=new CellRange(0,0,t.length-1,i.length-1),f,r;if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){var o=-h.y+this._offsetY,c=u._szClient.height,e=Math.min(t.frozen,t.length-1);e>0&&(r=t[e-1].pos,o+=r,c-=r);n.row=Math.min(t.length-1,Math.max(t.frozen,t.getItemAt(o+1)));n.row2=t.getItemAt(o+c);u._clipToScreen()&&(f=u.hostElement.getBoundingClientRect(),f.top<0&&(n.row=Math.max(n.row,t.getItemAt(-f.top)-1)),f.bottom>innerHeight&&(n.row2=Math.min(n.row2,t.getItemAt(-f.top+innerHeight)+1)))}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){var s=-h.x,l=u._szClient.width,e=Math.min(i.frozen,i.length-1);e>0&&(r=i[e-1].pos,s+=r,l-=r);n.col=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(s+1)));n.col2=i.getItemAt(s+l)}return t.length<=t.frozen&&(n.row=n.row2=-1),i.length<=i.frozen&&(n.col=n.col2=-1),n},n.prototype._getFrozenPos=function(){var i=this._rows.frozen,r=this._cols.frozen,n=i>0?this._rows[i-1]:null,t=r>0?this._cols[r-1]:null,u=n?n.pos+n.renderSize:0,f=t?t.pos+t.renderSize:0;return new wjcCore.Point(f,u)},n}();GridPanel._INDEX_KEY='wj-cell-index';exports.GridPanel=GridPanel;CellFactory=function(){function n(){}return n.prototype.updateCell=function(t,i,r,u,f,e){var o=t.grid,ft=o.rightToLeft,a=t.cellType,v=t.rows,y=t.columns,l=v[i],g=y[r],tt=i,et=r,p=l instanceof GroupRow?l:null,kt=l instanceof _NewRowTemplate?l:null,dt=g.renderWidth,gt=l.renderHeight,c='wj-cell',ct=e!=!1,h={display:''},lt,vt,st,k,ni,yt,ht,w,pt,wt,b,bt,nt,ti,it,ii,d,ri,rt,ut,ui;e!=!1&&u.firstElementChild&&(u.childNodes.length!=1||u.firstElementChild.type!='checkbox')&&(wjcCore.setText(u,null),ct=!1);f&&!f.isSingleCell&&(i=f.row,r=f.col,tt=f.row2,et=f.col2,l=v[i],g=y[r],p=wjcCore.tryCast(l,GroupRow),lt=f.getRenderSize(t),gt=lt.height,dt=lt.width);var s=o._getBindingColumn(t,i,g),fi=s.dataType==wjcCore.DataType.Boolean&&!s.dataMap,ot=g.pos,at=l.pos;o._useFrozenDiv()&&a==CellType.Cell&&!o.editRange?(i<v.frozen&&r>=y.frozen&&(ot+=o._ptScrl.x),r<y.frozen&&i>=v.frozen&&(at+=o._ptScrl.y)):(i<v.frozen&&(at-=o._ptScrl.y),r<y.frozen&&(ot-=o._ptScrl.x));(i<v.frozen||r<y.frozen)&&(ct=!1);ft?h.right=ot+'px':h.left=ot+'px';h.top=at-t._getOffsetY()+'px';h.width=dt+'px';h.height=gt+'px';h.zIndex='';(i<v.frozen||r<y.frozen)&&(h.zIndex=i<v.frozen&&r<y.frozen?2:1);a==CellType.Cell?(p&&(c+=' wj-group'),o.showAlternatingRows&&l.visibleIndex%2!=0&&(f&&f.row!=f.row2||(c+=' wj-alt')),(i<v.frozen||r<y.frozen)&&(c+=' wj-frozen'),kt&&(c+=' wj-new'),l.cssClass&&(c+=' '+l.cssClass),s.cssClass&&(c+=' '+s.cssClass)):(c+=' wj-header',o.showAlternatingRows&&i%2!=0&&(c+=' wj-header-alt'));(a==CellType.Cell||a==CellType.RowHeader)&&o._getShowErrors()&&(vt=o._getError(t,i,r),vt?(c+=' wj-state-invalid',u.title=vt):u.title='');st=t.getSelectedState(i,r,f);st!=SelectedState.None&&a==CellType.Cell&&!fi&&o.editRange&&o.editRange.contains(i,r)&&(st=SelectedState.None);switch(st){case SelectedState.Cursor:c+=' wj-state-selected';break;case SelectedState.Selected:c+=' wj-state-multi-selected'}if(tt==v.frozen-1&&(c+=' wj-frozen-row'),et==y.frozen-1&&(c+=' wj-frozen-col'),(s.wordWrap||l.wordWrap)&&(c+=' wj-wrap'),ct&&c==u.className&&(k=u.style,k.top==h.top&&k.width==h.width&&k.height==h.height&&(ft&&k.right==h.right||!ft&&k.left==h.left))){k.display&&(k.display='');return}h.textAlign=s.getAlignment();h.paddingLeft=h.paddingRight=h.paddingTop=h.paddingBottom='';a==CellType.Cell&&o.rows.maxGroupLevel>-1&&r==o.columns.firstVisibleIndex&&o.treeIndent&&(ni=p?Math.max(0,p.level):o.rows.maxGroupLevel+1,yt=o.treeIndent*ni+o._cellPadding,ft?h.paddingRight=yt+'px':h.paddingLeft=yt+'px');e!=!1&&(ht=t.getCellData(i,r,!1),w=t.getCellData(i,r,!0),a==CellType.Cell&&r==o.columns.firstVisibleIndex&&p&&p.hasChildren&&!this._isEditingCell(o,i,r)?(w||(w=p.getGroupHeader()),u.innerHTML=this._getTreeIcon(p)+' '+w,h.textAlign=''):a==CellType.ColumnHeader&&s.currentSort&&o.showSort&&(tt==o._getSortRowIndex()||s!=g)?(c+=' wj-sort-'+(s.currentSort=='+'?'asc':'desc'),u.innerHTML=wjcCore.escapeHtml(w)+'&nbsp;'+this._getSortIcon(s)):a!=CellType.RowHeader||r!=o.rowHeaders.columns.length-1||w?a!=CellType.Cell||s.dataType!=wjcCore.DataType.Boolean||s.dataMap||p&&!wjcCore.isBoolean(ht)?a==CellType.Cell&&this._isEditingCell(o,i,r)?(bt=s.inputType,s.inputType||(bt=s.dataType==wjcCore.DataType.Number&&!s.dataMap?'tel':'text'),s.dataMap||s.mask||(nt=t.getCellData(i,r,!1),wjcCore.isNumber(nt)&&(ti=nt.toString(),it=s.format,it&&nt!=Math.round(nt)&&(ii=ti.match(/\.(\d+)/)[1].length,it=it.replace(/([a-z])(\d*)(.*)/ig,'$01'+ii+'$3')),w=wjcCore.Globalize.formatNumber(nt,it,!0))),u.innerHTML='<input type="'+bt+'" class="wj-grid-editor wj-form-control">',d=u.children[0],d.value=w,d.required=s.getIsRequired(),s.maxLength&&(d.maxLength=s.maxLength),d.style.textAlign=s.getAlignment(),h.paddingTop=h.paddingBottom='0px',s.mask&&new wjcCore._MaskProvider(d,s.mask),o._edtHdl._edt=d):a==CellType.Cell&&(l.isContentHtml||s.isContentHtml)?u.innerHTML=w:wjcCore.setText(u,w):(b=u.firstChild,b instanceof HTMLInputElement&&b.type=='checkbox'||(u.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',b=u.firstChild),b.checked=ht==!0?!0:!1,b.indeterminate=ht==null,b.disabled=!o.canEditCell(i,r),b.disabled&&(b.style.cursor='default'),o.editRange&&o.editRange.contains(i,r)&&(o._edtHdl._edt=b)):(pt=o.editableCollectionView,wt=pt?pt.currentEditItem:null,wt&&l.dataItem==wt?u.innerHTML='<span class="wj-glyph-pencil"></span>':wjcCore.tryCast(l,_NewRowTemplate)&&(u.innerHTML='<span class="wj-glyph-asterisk"></span>')),a==CellType.Cell&&tryGetModuleWijmoInput()&&s.dataMap&&s.showDropDown!=!1&&o.canEditCell(i,r)&&(n._ddIcon||(n._ddIcon=wjcCore.createElement('<div role="button" class="'+n._WJC_DROPDOWN+'"><span class="wj-glyph-down"><\/span><\/div>')),ri=n._ddIcon.cloneNode(!0),u.appendChild(ri)));rt=!1;switch(a){case CellType.RowHeader:rt=!p&&!kt&&l.allowDragging&&(o.allowDragging&AllowDragging.Rows)!=0;wjcCore.setAttribute(u,'draggable',rt?'true':null);break;case CellType.ColumnHeader:rt=g.allowDragging&&(o.allowDragging&AllowDragging.Columns)!=0;wjcCore.setAttribute(u,'draggable',rt?'true':null)}if(u.className!=c&&(u.className=c),wjcCore.setCss(u,h),o.itemFormatter&&o.itemFormatter(t,i,r,u),o.formatItem.hasHandlers){ut=n._fmtRng;ut?ut.setRange(i,r,tt,et):ut=n._fmtRng=new CellRange(i,r,tt,et);ui=new FormatItemEventArgs(t,ut,u);o.onFormatItem(ui)}},n.prototype.disposeCell=function(){},n.prototype.getEditorValue=function(n){var t=n._edtHdl._edt;return t instanceof HTMLInputElement?t.type=='checkbox'?t.checked:t.value:null},n.prototype._isEditingCell=function(n,t,i){return n.editRange&&n.editRange.contains(t,i)},n.prototype._getTreeIcon=function(t){var i='wj-glyph-'+(t.isCollapsed?'':'down-')+(t.grid.rightToLeft?'left':'right');return'<span role="button" class="'+n._WJC_COLLAPSE+' '+i+'"></span>'},n.prototype._getSortIcon=function(n){return'<span class="wj-glyph-'+(n.currentSort=='+'?'up':'down')+'"></span>'},n}();CellFactory._WJC_COLLAPSE='wj-elem-collapse';CellFactory._WJC_DROPDOWN='wj-elem-dropdown';exports.CellFactory=CellFactory;CellRange=function(){function n(n,t,i,r){n===void 0&&(n=-1);t===void 0&&(t=-1);i===void 0&&(i=n);r===void 0&&(r=t);this.setRange(n,t,i,r)}return n.prototype.setRange=function(n,t,i,r){n===void 0&&(n=-1);t===void 0&&(t=-1);i===void 0&&(i=n);r===void 0&&(r=t);this._row=wjcCore.asInt(n);this._col=wjcCore.asInt(t);this._row2=wjcCore.asInt(i);this._col2=wjcCore.asInt(r)},Object.defineProperty(n.prototype,"row",{get:function(){return this._row},set:function(n){this._row=wjcCore.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col",{get:function(){return this._col},set:function(n){this._col=wjcCore.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"row2",{get:function(){return this._row2},set:function(n){this._row2=wjcCore.asInt(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col2",{get:function(){return this._col2},set:function(n){this._col2=wjcCore.asInt(n)},enumerable:!0,configurable:!0}),n.prototype.clone=function(){return new n(this._row,this._col,this._row2,this._col2)},Object.defineProperty(n.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0}),n.prototype.contains=function(t,i){var r=wjcCore.tryCast(t,n);if(r)return r.topRow>=this.topRow&&r.bottomRow<=this.bottomRow&&r.leftCol>=this.leftCol&&r.rightCol<=this.rightCol;if(wjcCore.isInt(t)&&wjcCore.isInt(i))return t>=this.topRow&&t<=this.bottomRow&&i>=this.leftCol&&i<=this.rightCol;throw'contains expects a CellRange or row/column indices.';},n.prototype.containsRow=function(n){return wjcCore.asInt(n)>=this.topRow&&n<=this.bottomRow},n.prototype.containsColumn=function(n){return wjcCore.asInt(n)>=this.leftCol&&n<=this.rightCol},n.prototype.intersects=function(n){return this.intersectsRow(n)&&this.intersectsColumn(n)},n.prototype.intersectsRow=function(n){return n&&!(this.bottomRow<n.topRow||this.topRow>n.bottomRow)},n.prototype.intersectsColumn=function(n){return n&&!(this.rightCol<n.leftCol||this.leftCol>n.rightCol)},n.prototype.getRenderSize=function(n){var r=new wjcCore.Size(0,0),t,i;if(this.isValid){for(t=this.topRow;t<=this.bottomRow;t++)r.height+=n.rows[t].renderSize;for(i=this.leftCol;i<=this.rightCol;i++)r.width+=n.columns[i].renderSize}return r},n.prototype.equals=function(t){return t instanceof n&&this._row==t._row&&this._col==t._col&&this._row2==t._row2&&this._col2==t._col2},n}();exports.CellRange=CellRange,function(n){n[n.Visible=1]="Visible";n[n.AllowResizing=2]="AllowResizing";n[n.AllowDragging=4]="AllowDragging";n[n.AllowMerging=8]="AllowMerging";n[n.AllowSorting=16]="AllowSorting";n[n.AutoGenerated=32]="AutoGenerated";n[n.Collapsed=64]="Collapsed";n[n.ParentCollapsed=128]="ParentCollapsed";n[n.Selected=256]="Selected";n[n.ReadOnly=512]="ReadOnly";n[n.HtmlContent=1024]="HtmlContent";n[n.WordWrap=2048]="WordWrap";n[n.RowDefault=3]="RowDefault";n[n.ColumnDefault=23]="ColumnDefault"}(RowColFlags=exports.RowColFlags||(exports.RowColFlags={}));RowCol=function(){function n(){this._list=null;this._pos=0;this._idx=-1;this._vidx=-1}return Object.defineProperty(n.prototype,"visible",{get:function(){return this._getFlag(RowColFlags.Visible)},set:function(n){this._setFlag(RowColFlags.Visible,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isVisible",{get:function(){return this._getFlag(RowColFlags.Visible)?this._getFlag(RowColFlags.ParentCollapsed)&&!(this instanceof _NewRowTemplate)?!1:!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pos",{get:function(){return this._list&&this._list._update(),this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this._list&&this._list._update(),this._idx},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visibleIndex",{get:function(){return this._list&&this._list._update(),this.isVisible?this._vidx:-1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._sz},set:function(n){n!=this._sz&&(this._sz=wjcCore.asNumber(n,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderSize",{get:function(){if(!this.isVisible)return 0;var n=this._sz,t=this._list;return t&&((n==null||n<0)&&(n=Math.round(t.defaultSize)),t.minSize!=null&&n<t.minSize&&(n=t.minSize),t.maxSize!=null&&n>t.maxSize&&(n=t.maxSize)),this._szMin!=null&&n<this._szMin&&(n=this._szMin),this._szMax!=null&&n>this._szMax&&(n=this._szMax),Math.round(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowResizing",{get:function(){return this._getFlag(RowColFlags.AllowResizing)},set:function(n){this._setFlag(RowColFlags.AllowResizing,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowDragging",{get:function(){return this._getFlag(RowColFlags.AllowDragging)},set:function(n){this._setFlag(RowColFlags.AllowDragging,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowMerging",{get:function(){return this._getFlag(RowColFlags.AllowMerging)},set:function(n){this._setFlag(RowColFlags.AllowMerging,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isSelected",{get:function(){return this._getFlag(RowColFlags.Selected)},set:function(n){if(this._setFlag(RowColFlags.Selected,n,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isReadOnly",{get:function(){return this._getFlag(RowColFlags.ReadOnly)},set:function(n){this._setFlag(RowColFlags.ReadOnly,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isContentHtml",{get:function(){return this._getFlag(RowColFlags.HtmlContent)},set:function(n){this.isContentHtml!=n&&(this._setFlag(RowColFlags.HtmlContent,n),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wordWrap",{get:function(){return this._getFlag(RowColFlags.WordWrap)},set:function(n){this._setFlag(RowColFlags.WordWrap,n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cssClass",{get:function(){return this._cssClass},set:function(n){n!=this._cssClass&&(this._cssClass=wjcCore.asString(n),this.grid&&this.grid.invalidate(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0}),n.prototype.onPropertyChanged=function(){this._list&&(this._list._dirty=!0,this.grid.invalidate())},n.prototype._getFlag=function(n){return(this._f&n)!=0},n.prototype._setFlag=function(n,t,i){return t!=this._getFlag(n)?(this._f=t?this._f|n:this._f&~n,i||this.onPropertyChanged(),!0):!1},n}();exports.RowCol=RowCol;Column=function(n){function t(i){var r=n.call(this)||this;return r._f=RowColFlags.ColumnDefault,r._hash=t._ctr.toString(36),t._ctr++,i&&wjcCore.copy(r,i),r}return __extends(t,n),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(n){this._name=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataType",{get:function(){return this._type},set:function(n){this._type!=n&&(this._type=wjcCore.asEnum(n,wjcCore.DataType),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRequired",{get:function(){return this._required},set:function(n){this._required=wjcCore.asBoolean(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._showDropDown},set:function(n){n!=this._showDropDown&&(this._showDropDown=wjcCore.asBoolean(n,!0),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(n){this._ddCssClass=wjcCore.asString(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputType",{get:function(){return this._inpType},set:function(n){this._inpType=wjcCore.asString(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask=wjcCore.asString(n,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLength",{get:function(){return this._maxLen},set:function(n){this._maxLen=wjcCore.asNumber(n,!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(n){var i,t,r;n!=this.binding&&(i=wjcCore.asString(n),this._binding=i?new wjcCore.Binding(i):null,!this._type&&this.grid&&this._binding&&(t=this.grid.collectionView,t&&t.sourceCollection&&t.sourceCollection.length&&(r=t.sourceCollection[0],this._type=wjcCore.getType(this._binding.getValue(r)))),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(n){if(n!=this.sortMemberPath){var t=wjcCore.asString(n);this._bindingSort=t?new wjcCore.Binding(t):null;this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._szStar!=null?this._szStar:this.size},set:function(n){t._parseStarSize(n)!=null?(this._szStar=n,this.onPropertyChanged()):(this._szStar=null,this.size=wjcCore.asNumber(n,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minWidth",{get:function(){return this._szMin},set:function(n){n!=this._szMin&&(this._szMin=wjcCore.asNumber(n,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._szMax},set:function(n){n!=this._szMax&&(this._szMax=wjcCore.asNumber(n,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(n){this._align!=n&&(this._align=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype.getAlignment=function(){var n=this._align;if(n==null&&(n='',!this._map))switch(this._type){case wjcCore.DataType.Boolean:n='center';break;case wjcCore.DataType.Number:n='right'}return n},t.prototype.getIsRequired=function(){return this._required!=null?this._required:this.dataType==wjcCore.DataType.String?this.dataMap!=null||this._mask&&this._mask.length>0:!0},Object.defineProperty(t.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(n){this._hdr!=n&&(this._hdr=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataMap",{get:function(){return this._map},set:function(n){this._map!=n&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),wjcCore.isArray(n)&&(n=new DataMap(n,null,null)),this._map=wjcCore.asType(n,DataMap,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._fmt},set:function(n){this._fmt!=n&&(this._fmt=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._getFlag(RowColFlags.AllowSorting)},set:function(n){this._setFlag(RowColFlags.AllowSorting,n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSort",{get:function(){var t,n;if(this.grid&&this.grid.collectionView&&this.grid.collectionView.canSort)for(t=this.grid.collectionView.sortDescriptions,n=0;n<t.length;n++)if(t[n].property==this._getBindingSort())return t[n].ascending?'+':'-';return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){return this._agg!=null?this._agg:wjcCore.Aggregate.None},set:function(n){n!=this._agg&&(this._agg=wjcCore.asEnum(n,wjcCore.Aggregate),this.onPropertyChanged())},enumerable:!0,configurable:!0}),t.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null},t._parseStarSize=function(n){if(wjcCore.isString(n)&&n.length>0&&n[n.length-1]=='*'){var t=n.length==1?1:n.substr(0,n.length-1)*1;if(t>0&&!isNaN(t))return t}return null},t}(RowCol);Column._ctr=0;exports.Column=Column;Row=function(n){function t(t){var i=n.call(this)||this;return i._f=RowColFlags.ColumnDefault,i._data=t,i}return __extends(t,n),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},set:function(n){this._data=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size},set:function(n){this.size=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),t}(RowCol);exports.Row=Row;GroupRow=function(n){function t(){var t=n.call(this)||this;return t._level=-1,t.isReadOnly=!0,t}return __extends(t,n),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(n){wjcCore.asInt(n);n!=this._level&&(this._level=n,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){if(this.grid!=null&&this._list!=null){this._list._update();var n=this.index<this._list.length-1?this._list[this.index+1]:null,i=wjcCore.tryCast(n,t),r=wjcCore.tryCast(n,_NewRowTemplate);return n!=null&&r==null&&(i==null||i.level>this.level)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this._getFlag(RowColFlags.Collapsed)},set:function(n){wjcCore.asBoolean(n);n!=this.isCollapsed&&this._list!=null&&this._setCollapsed(n)},enumerable:!0,configurable:!0}),t.prototype.getGroupHeader=function(){var r=this.grid,e=r.groupHeaderFormat?r.groupHeaderFormat:wjcCore.culture.FlexGrid.groupHeaderFormat,i=wjcCore.tryCast(this.dataItem,wjcCore.CollectionViewGroup),o;if(i&&e){var u=i.groupDescription.propertyName,t=i.name,n=r.getColumn(u),f=this.isContentHtml;return n&&(f=f||n.isContentHtml,n.header&&(u=n.header),n.dataMap?t=n.dataMap.getDisplayValue(t):n.format&&(t=wjcCore.Globalize.format(t,n.format))),o=i.getAggregate(wjcCore.Aggregate.CntAll,null,r.collectionView),wjcCore.format(e,{name:wjcCore.escapeHtml(u),value:f?t:wjcCore.escapeHtml(t),level:i.level,count:o})}return''},t.prototype._setCollapsed=function(n){var o=this,i=this.grid,u=i.rows,e=this.getCellRange(),f=new CellRangeEventArgs(i.cells,new CellRange(this.index,-1)),r;i.onGroupCollapsedChanging(f);if(!f.cancel){i.deferUpdate(function(){o._setFlag(RowColFlags.Collapsed,n);for(var i=e.topRow+1;i<=e.bottomRow&&i>-1&&i<u.length;i++)u[i]._setFlag(RowColFlags.ParentCollapsed,n),r=wjcCore.tryCast(u[i],t),r!=null&&r.isCollapsed&&(i=r.getCellRange().bottomRow)});i.onGroupCollapsedChanged(f)}},t.prototype.getCellRange=function(){for(var r,u=this._list,f=this.index,i=u.length-1,n=f+1;n<=i;n++)if(r=wjcCore.tryCast(u[n],t),r!=null&&r.level<=this.level){i=n-1;break}return new CellRange(f,0,i,this.grid.columns.length-1)},t}(Row);exports.GroupRow=GroupRow;RowColCollection=function(n){function t(t,i){var r=n.call(this)||this;return r._frozen=0,r._vlen=0,r._szDef=28,r._szTot=0,r._dirty=!1,r._g=wjcCore.asType(t,FlexGrid),r._szDef=wjcCore.asNumber(i,!1,!0),r}return __extends(t,n),Object.defineProperty(t.prototype,"defaultSize",{get:function(){return this._szDef},set:function(n){this._szDef!=n&&(this._szDef=wjcCore.asNumber(n,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(n){n!=this._frozen&&(this._frozen=wjcCore.asNumber(n,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.isFrozen=function(n){return n<this.frozen},Object.defineProperty(t.prototype,"minSize",{get:function(){return this._szMin},set:function(n){n!=this._szMin&&(this._szMin=wjcCore.asNumber(n,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._szMax},set:function(n){n!=this._szMax&&(this._szMax=wjcCore.asNumber(n,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getTotalSize=function(){return this._update(),this._szTot},Object.defineProperty(t.prototype,"visibleLength",{get:function(){return this._update(),this._vlen},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(n){if(this._update(),n<=0&&this.length>0)return 0;for(var u=0,i=this.length-1,t,r;u<=i;)if(t=u+i>>>1,r=this[t],r._pos>n)i=t-1;else if(r._pos+r.renderSize<n)u=t+1;else{while(t>0&&!this[t].visible)t--;while(t<this.length-1&&!this[t].visible)t++;return t}return i},t.prototype.getNextCell=function(n,t,i){var r;switch(t){case SelMove.Next:for(r=n+1;r<this.length;r++)if(this[r].renderSize>0)return r;break;case SelMove.Prev:for(r=n-1;r>=0;r--)if(this[r].renderSize>0)return r;break;case SelMove.End:for(r=this.length-1;r>=0;r--)if(this[r].renderSize>0)return r;break;case SelMove.Home:for(r=0;r<this.length;r++)if(this[r].renderSize>0)return r;break;case SelMove.NextPage:return r=this.getItemAt(this[n].pos+i),r<0?this.getNextCell(n,SelMove.End,i):r==n&&r<this.length-1?r+1:r;case SelMove.PrevPage:return r=this.getItemAt(this[n].pos-i),r<0?this.getNextCell(n,SelMove.Home,i):r==n&&r>0?r-1:r}return n},t.prototype.canMoveElement=function(n,t){var r,u,i;if(t==n||n<0||n>=this.length||t>=this.length)return!1;for(t<0&&(t=this.length-1),r=Math.min(n,t),u=Math.max(n,t),i=r;i<=u;i++)if(!this[i].allowDragging)return!1;return this[t]instanceof _NewRowTemplate?!1:!0},t.prototype.moveElement=function(n,t){if(this.canMoveElement(n,t)){var i=this[n];this.removeAt(n);t<0&&(t=this.length);this.insert(t,i)}},t.prototype.onCollectionChanged=function(t){t===void 0&&(t=wjcCore.NotifyCollectionChangedEventArgs.reset);this._dirty=!0;this._g.invalidate();n.prototype.onCollectionChanged.call(this,t)},t.prototype.push=function(t){return t._list=this,n.prototype.push.call(this,t)},t.prototype.splice=function(t,i,r){return r&&(r._list=this),n.prototype.splice.call(this,t,i,r)},t.prototype.beginUpdate=function(){this._update();n.prototype.beginUpdate.call(this)},t.prototype._update=function(){var t;if(this._dirty&&!this.isUpdating){this._dirty=!1;var i=0,r=0,u=void 0,n=void 0;for(t=0;t<this.length;t++)n=this[t],n._idx=t,n._vidx=i,n._list=this,n._pos=r,u=n.renderSize,u>0&&(r+=u,i++);return this._vlen=i,this._szTot=r,!0}return!1},t}(wjcCore.ObservableArray);exports.RowColCollection=RowColCollection;ColumnCollection=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._firstVisible=-1,t}return __extends(t,n),t.prototype.getColumn=function(n){var t=wjcCore.isNumber(n)?n:this.indexOf(n);return t>-1?this[t]:null},t.prototype.indexOf=function(t){var i;if(t instanceof Column)return n.prototype.indexOf.call(this,t);for(i=0;i<this.length;i++)if(this[i].name==t)return i;for(i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1},Object.defineProperty(t.prototype,"firstVisibleIndex",{get:function(){return this._update(),this._firstVisible},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(n.prototype._update.call(this)){this._firstVisible=-1;for(var t=0;t<this.length;t++)if(this[t].visible){this._firstVisible=t;break}return!0}return!1},t.prototype._updateStarSizes=function(n){for(var r,t,f=0,u,i=0;i<this.length;i++)t=this[i],t.isVisible&&(t._szStar?(f+=Column._parseStarSize(t._szStar),u=t):n-=t.renderWidth);if(u){for(r=n,i=0;i<this.length;i++)t=this[i],t.isVisible&&t._szStar&&(t==u&&r>0?t._sz=r:(t._sz=Math.max(0,Math.round(Column._parseStarSize(t._szStar)/f*n)),r-=t.renderWidth));return this._dirty=!0,this._update(),!0}return!1},t}(RowColCollection);exports.ColumnCollection=ColumnCollection;RowCollection=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._maxLevel=-1,t}return __extends(t,n),Object.defineProperty(t.prototype,"maxGroupLevel",{get:function(){return this._update(),this._maxLevel},enumerable:!0,configurable:!0}),t.prototype._update=function(){var t,i;if(n.prototype._update.call(this)){for(this._maxLevel=-1,t=0;t<this.length;t++)i=wjcCore.tryCast(this[t],GroupRow),i&&i.level>this._maxLevel&&(this._maxLevel=i.level);return!0}return!1},t}(RowColCollection);exports.RowCollection=RowCollection;HitTestInfo=function(){function n(t,i){var r,v,e,s,l,a;if(this._row=-1,this._col=-1,this._edge=0,t instanceof Element){v=wjcCore.closest(t,'.wj-cell');e=v?v[GridPanel._INDEX_KEY]:null;e&&(this._row=e.row,this._col=e.col,this._rng=e.rng,this._p=e.panel,this._g=e.panel.grid);return}if(t instanceof FlexGrid)r=this._g=t;else if(t instanceof GridPanel)this._p=t,r=this._g=this._p.grid;else throw'First parameter should be a FlexGrid or GridPanel.';i=wjcCore.mouseToPage(i);this._pt=i.clone();var y=r.controlRect,p=r._szClient,tt=r.topLeftCells,it=r._eTL,w=r.headersVisibility,b=HeadersVisibility,o=w&b.Row?tt.columns.getTotalSize():0,h=w&b.Column?tt.rows.getTotalSize():0,k=w&b.Column?h+it.offsetTop:0,d=r._eBL,rt=d.offsetHeight;if(i.x-=y.left,i.y-=y.top,this._g.rightToLeft&&(i.x=y.width-i.x),!this._p&&i.x>=0&&i.y>=it.offsetTop&&p&&i.x<=p.width+o&&i.y<=p.height+k&&(this._p=i.y<k?i.x<o?r.topLeftCells:r.columnHeaders:i.y<d.offsetTop?i.x<o?r.rowHeaders:r.cells:i.x<o?r.bottomLeftCells:r.columnFooters),this._p!=null){var g=this._p.rows,nt=this._p.columns,u=this._p.cellType,f=CellType,c=this._p._getFrozenPos(),ut=u==f.TopLeft||u==f.ColumnHeader?h:u==f.BottomLeft||u==f.ColumnFooter?rt:g.getTotalSize(),ft=u==f.TopLeft||u==f.BottomLeft||u==f.RowHeader?o:nt.getTotalSize();if(u==f.RowHeader||u==f.Cell?(i.y-=h,(i.y>c.y||c.y<=0)&&(i.y-=r._ptScrl.y,i.y+=this._p._getOffsetY())):(u==f.BottomLeft||u==f.ColumnFooter)&&(i.y-=d.offsetTop),(u==f.ColumnHeader||u==f.Cell||u==f.ColumnFooter)&&(i.x-=o,(i.x>c.x||c.x<=0)&&(i.x-=r._ptScrl.x)),(u==f.ColumnHeader||u==f.TopLeft)&&(i.y-=k-h),this._row=i.y>ut?-1:g.getItemAt(i.y),this._col=i.x>ft?-1:nt.getItemAt(i.x),this._row<0||this._col<0){this._p=null;return}this._edge=0;s=n._SZEDGE[this._g.isTouching?1:0];this._col>-1&&(l=nt[this._col],i.x-l.pos<=s&&(this._edge|=1),l.pos+l.renderSize-i.x<=s&&(this._edge|=4));this._row>-1&&(a=g[this._row],i.y-a.pos<=s&&(this._edge|=2),a.pos+a.renderSize-i.y<=s&&(this._edge|=8))}}return Object.defineProperty(n.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cellType",{get:function(){return this._p?this._p.cellType:CellType.None},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"range",{get:function(){return this._rng||(this._rng=new CellRange(this._row,this._col)),this._rng},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeLeft",{get:function(){return(this._edge&1)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeTop",{get:function(){return(this._edge&2)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeRight",{get:function(){return(this._edge&4)!=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"edgeBottom",{get:function(){return(this._edge&8)!=0},enumerable:!0,configurable:!0}),n}();HitTestInfo._SZEDGE=[5,30];exports.HitTestInfo=HitTestInfo,function(n){n[n.None=0]="None";n[n.Cells=1]="Cells";n[n.ColumnHeaders=2]="ColumnHeaders";n[n.RowHeaders=4]="RowHeaders";n[n.AllHeaders=6]="AllHeaders";n[n.All=7]="All"}(AllowMerging=exports.AllowMerging||(exports.AllowMerging={}));MergeManager=function(){function n(n){this._g=n}return n.prototype.getMergedRange=function(n,t,i,r){var o,b,y,c,l,k,p,a,v;r===void 0&&(r=!0);var u,s,e=n.cellType,f=n.columns,h=n.rows,w=h[t],d=f[i];if(w instanceof _NewRowTemplate)return null;if(w instanceof GroupRow&&w.dataItem instanceof wjcCore.CollectionViewGroup){if(u=new CellRange(t,i),d.aggregate==wjcCore.Aggregate.None){while(u.col>0&&f[u.col-1].aggregate==wjcCore.Aggregate.None&&u.col!=f.frozen)u.col--;while(u.col2<f.length-1&&f[u.col2+1].aggregate==wjcCore.Aggregate.None&&u.col2+1!=f.frozen)u.col2++}while(u.col<i&&!f[u.col].visible)u.col++;return u.isSingleCell?null:u}o=!1;switch(this._g.allowMerging){case AllowMerging.None:o=!0;break;case AllowMerging.Cells:o=e!=CellType.Cell;break;case AllowMerging.ColumnHeaders:o=e!=CellType.ColumnHeader&&e!=CellType.TopLeft;break;case AllowMerging.RowHeaders:o=e!=CellType.RowHeader&&e!=CellType.TopLeft;break;case AllowMerging.AllHeaders:o=e==CellType.Cell}if(o)return null;if(f[i].allowMerging){for(u=new CellRange(t,i),b=0,y=h.length-1,t>=h.frozen?r&&(e==CellType.Cell||e==CellType.RowHeader)&&(s=n._getViewRange(),b=s.topRow,y=s.bottomRow):y=h.frozen-1,c=t-1;c>=b&&this._mergeCell(n,c,i,t,i);c--)u.row=c;for(l=t+1;l<=y&&this._mergeCell(n,t,i,l,i);l++)u.row2=l;while(u.row<t&&!h[u.row].visible)u.row++;if(!u.isSingleCell)return u}if(h[t].allowMerging){for(u=new CellRange(t,i),k=0,p=f.length-1,i>=f.frozen?r&&(e==CellType.Cell||e==CellType.ColumnHeader)&&(s=n._getViewRange(),k=s.leftCol,p=s.rightCol):p=f.frozen-1,a=i-1;a>=k&&this._mergeCell(n,t,a,t,i);a--)u.col=a;for(v=i+1;v<=p&&this._mergeCell(n,t,i,t,v);v++)u.col2=v;while(u.col<i&&!f[u.col].visible)u.col++;if(!u.isSingleCell)return u}return null},n.prototype._mergeCell=function(n,t,i,r,u){var f=n.rows[t],e=n.rows[r];return f instanceof GroupRow||f instanceof _NewRowTemplate||e instanceof GroupRow||e instanceof _NewRowTemplate?!1:t!=r&&n.rows.isFrozen(t)!=n.rows.isFrozen(r)?!1:i!=u&&n.columns.isFrozen(i)!=n.columns.isFrozen(u)?!1:t!=r&&(i>0&&(f.allowMerging&&this._mergeCell(n,t,i-1,t,i)||e.allowMerging&&this._mergeCell(n,r,i-1,r,i))||u<n.columns.length-1&&(f.allowMerging&&this._mergeCell(n,t,u,t,u+1)||e.allowMerging&&this._mergeCell(n,r,u,r,u+1)))?!1:n.getCellData(t,i,!0)!=n.getCellData(r,u,!0)?!1:!0},n}();exports.MergeManager=MergeManager;DataMap=function(){function n(n,t,i){var u,r;if(this.mapChanged=new wjcCore.Event,wjcCore.isArray(n)&&!t&&!i){for(u=[],r=0;r<n.length;r++)u.push({value:n[r]});n=u;t=i='value'}this._cv=wjcCore.asCollectionView(n);this._keyPath=wjcCore.asString(t,!1);this._displayPath=wjcCore.asString(i,!1);this._cv.collectionChanged.addHandler(this.onMapChanged,this)}return Object.defineProperty(n.prototype,"sortByDisplayValues",{get:function(){return this._sortByKey!=!0},set:function(n){this._sortByKey=!wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0}),n.prototype.getKeyValue=function(n){var t=this._indexOf(n,this._displayPath,!1);return t>-1?this._cv.sourceCollection[t][this._keyPath]:null},n.prototype.getDisplayValue=function(n){var t,i,r;if(!this._hash&&(this._hash={},t=this._cv.sourceCollection,t&&this._keyPath&&this._displayPath))for(i=t.length-1;i>=0;i--){var u=t[i],f=u[this._keyPath],e=u[this._displayPath];this._hash[f]=e}return r=this._hash[n],r!=null?r:n},n.prototype.getDisplayValues=function(){var i=[],t,n;if(this._cv&&this._displayPath)for(t=this._cv.items,n=0;n<t.length;n++)i.push(t[n][this._displayPath]);return i},n.prototype.getKeyValues=function(){var i=[],t,n;if(this._cv&&this._keyPath)for(t=this._cv.items,n=0;n<t.length;n++)i.push(t[n][this._keyPath]);return i},Object.defineProperty(n.prototype,"isEditable",{get:function(){return this._editable},set:function(n){this._editable=wjcCore.asBoolean(n)},enumerable:!0,configurable:!0}),n.prototype.onMapChanged=function(n){this._hash=null;this.mapChanged.raise(this,n)},n.prototype._indexOf=function(n,t,i){var u=-1,e=-1,r,s,f;if(this._cv&&t){var o=n!=null?n.toString():'',h=i?o:o.toLowerCase(),c=this._cv.sourceCollection;for(r=0;r<c.length;r++)if(s=c[r],f=s[t],f==n?u=r:i||f.length!=h.length||f.toLowerCase()!=h?f!=null&&f.toString()==o&&(u=r):u=r,u==r){if(!this._cv.filter||this._cv.filter(s))return u;e<0&&(e=u)}}return e},n}();exports.DataMap=DataMap,function(n){n[n.None=0]="None";n[n.Cell=1]="Cell";n[n.CellRange=2]="CellRange";n[n.Row=3]="Row";n[n.RowRange=4]="RowRange";n[n.ListBox=5]="ListBox"}(SelectionMode=exports.SelectionMode||(exports.SelectionMode={})),function(n){n[n.None=0]="None";n[n.Selected=1]="Selected";n[n.Cursor=2]="Cursor"}(SelectedState=exports.SelectedState||(exports.SelectedState={})),function(n){n[n.None=0]="None";n[n.Next=1]="Next";n[n.Prev=2]="Prev";n[n.NextPage=3]="NextPage";n[n.PrevPage=4]="PrevPage";n[n.Home=5]="Home";n[n.End=6]="End";n[n.NextCell=7]="NextCell";n[n.PrevCell=8]="PrevCell"}(SelMove=exports.SelMove||(exports.SelMove={}));_SelectionHandler=function(){function n(n){this._sel=new CellRange(0,0);this._mode=SelectionMode.CellRange;this._g=n}return Object.defineProperty(n.prototype,"selectionMode",{get:function(){return this._mode},set:function(n){var t,r,i,u,f;if(n!=this._mode){if(t=SelectionMode,n==t.ListBox||this._mode==t.ListBox)for(r=this._g.rows,i=0;i<r.length;i++)u=r[i],f=n==SelectionMode.ListBox?this._sel.containsRow(i):!1,u._setFlag(RowColFlags.Selected,f,!0);switch(n){case t.None:this._sel.setRange(-1,-1);break;case t.Cell:this._sel.row2=this._sel.row;this._sel.col2=this._sel.col;break;case t.Row:this._sel.row2=this._sel.row}this._mode=n;this._g.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selection",{get:function(){return this._sel},set:function(n){this.select(n)},enumerable:!0,configurable:!0}),n.prototype.select=function(n,t){var o,s,u,h;t===void 0&&(t=!0);wjcCore.isNumber(n)&&wjcCore.isNumber(t)&&(n=new CellRange(n,t),t=!0);n=wjcCore.asType(n,CellRange);var i=this._g,c=this._sel,r=n,f=!1,e=SelectionMode;switch(i.selectionMode){case e.Cell:n.row2=n.row;n.col2=n.col;break;case e.Row:n.row2=n.row;break;case e.ListBox:f=!0}if(o=r.equals(c),f&&r.row>-1&&!i.rows[r.row].isSelected&&(o=!1),o){t&&i.scrollIntoView(r.row,r.col);return}if(s=new CellRangeEventArgs(i.cells,r),i.onSelectionChanging(s)){if(f){for(u=0;u<i.rows.length;u++)i.rows[u]._setFlag(RowColFlags.Selected,r.containsRow(u),!0);i.refreshCells(!1,!0,!0)}r.row=Math.min(r.row,i.rows.length-1);r.row2=Math.min(r.row2,i.rows.length-1);this._sel=r;i.refreshCells(!1,!0,!0);t&&i.scrollIntoView(r.row,r.col);i.collectionView&&(h=i._getCvIndex(r.row),i.collectionView.moveCurrentToPosition(h));i.onSelectionChanged(s)}},n.prototype.moveSelection=function(n,t,i){var u,r,o=this._g,h=o.rows,s=o.columns,f=this._getReferenceCell(n,t,i),e=Math.max(0,o._szClient.height-o.columnHeaders.height),c;t==SelMove.NextCell?(r=s.getNextCell(f.col,SelMove.Next,e),u=f.row,r==f.col&&(u=h.getNextCell(u,SelMove.Next,e),u>f.row&&(r=s.getNextCell(0,SelMove.Next,e),r=s.getNextCell(r,SelMove.Prev,e))),o.select(u,r)):t==SelMove.PrevCell?(r=s.getNextCell(f.col,SelMove.Prev,e),u=f.row,r==f.col&&(u=h.getNextCell(u,SelMove.Prev,e),u<f.row&&(r=s.getNextCell(s.length-1,SelMove.Prev,e),r=s.getNextCell(r,SelMove.Next,e))),o.select(u,r)):(u=h.getNextCell(f.row,n,e),r=s.getNextCell(f.col,t,e),i?(c=o._selHdl._sel,o.select(new CellRange(u,r,c.row2,c.col2))):o.select(u,r))},n.prototype._getReferenceCell=function(n,t){var u=this._g,r=u._selHdl._sel,i=u.getMergedRange(u.cells,r.row,r.col);if(!i||i.isSingleCell)return r;i=i.clone();switch(n){case SelMove.Next:case SelMove.NextCell:i.row=i.bottomRow;break;case SelMove.None:i.row=r.row}switch(t){case SelMove.Next:case SelMove.NextCell:i.col=i.rightCol;break;case SelMove.None:i.col=r.col}return i},n.prototype._adjustSelection=function(n){switch(this._mode){case SelectionMode.Cell:return new CellRange(n.row,n.col,n.row,n.col);case SelectionMode.Row:return new CellRange(n.row,0,n.row,this._g.columns.length-1);case SelectionMode.RowRange:case SelectionMode.ListBox:return new CellRange(n.row,0,n.row2,this._g.columns.length-1)}return n},n}();exports._SelectionHandler=_SelectionHandler,function(n){n[n.None=0]="None";n[n.MoveDown=1]="MoveDown";n[n.MoveAcross=2]="MoveAcross";n[n.Cycle=3]="Cycle"}(KeyAction=exports.KeyAction||(exports.KeyAction={}));_KeyboardHandler=function(){function n(n){this._kaTab=KeyAction.None;this._kaEnter=KeyAction.MoveDown;this._g=n;var t=n.hostElement;n.addEventListener(t,'keypress',this._keypress.bind(this));n.addEventListener(t,'keydown',this._keydown.bind(this))}return n.prototype._keydown=function(n){var t=this._g,u=t.selection,e=n.ctrlKey||n.metaKey,f=n.shiftKey,w=n.target,r=!0,y,a,p,v,i,o,l;if((this._altDown=!1,!t._wantsInput(n.target))&&(!t.activeEditor||!t._edtHdl._keydown(n))&&(y=n.defaultPrevented&&!(n.target instanceof HTMLInputElement),t.isRangeValid(u)&&!y)){var c=wjcCore.tryCast(t.rows[u.row],GroupRow),s=t.editableCollectionView,h=n.keyCode;if(t.autoClipboard){if(e&&(h==67||h==45)){if(a=new CellRangeEventArgs(t.cells,u),t.onCopying(a)){p=t.getClipString()+'\r\n';wjcCore.Clipboard.copy(p);t.onCopied(a)}n.stopPropagation();return}if(e&&h==86||f&&h==45){t.isReadOnly||(v=new CellRangeEventArgs(t.cells,u),t.onPasting(v)&&wjcCore.Clipboard.paste(function(n){t.setClipString(n);t.onPasted(v)}));n.stopPropagation();return}}if(t.rightToLeft)switch(h){case wjcCore.Key.Left:h=wjcCore.Key.Right;break;case wjcCore.Key.Right:h=wjcCore.Key.Left}i=SelMove;o=SelectionMode;switch(h){case wjcCore.Key.Space:if(f&&u.isValid)switch(t.selectionMode){case o.CellRange:case o.Row:case o.RowRange:case o.ListBox:t.select(new CellRange(u.row,0,u.row,t.columns.length-1))}else if(e&&u.isValid)switch(t.selectionMode){case o.CellRange:t.select(new CellRange(0,u.col,t.rows.length-1,u.col))}else r=this._startEditing(!0,n),r&&setTimeout(function(){var n=t.activeEditor;n&&(n.disabled||n.readOnly?t.finishEditing():n.type=='checkbox'?(n.checked=!n.checked,t.finishEditing()):wjcCore.setSelectionRange(n,n.value.length))});break;case 65:if(e)switch(t.selectionMode){case o.CellRange:case o.Row:case o.RowRange:case o.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}else r=!1;break;case wjcCore.Key.Left:e||n.altKey?r=!1:u.isValid&&u.col==0&&c!=null&&!c.isCollapsed&&c.hasChildren?c.isCollapsed=!0:this._moveSel(i.None,e?i.Home:i.Prev,f);break;case wjcCore.Key.Right:e||n.altKey?r=!1:u.isValid&&u.col==0&&c!=null&&c.isCollapsed?c.isCollapsed=!1:this._moveSel(i.None,e?i.End:i.Next,f);break;case wjcCore.Key.Up:e?r=!1:(this._altDown=n.altKey,n.altKey?r=t._edtHdl._toggleListBox(n):this._moveSel(i.Prev,i.None,f));break;case wjcCore.Key.Down:e?r=!1:(this._altDown=n.altKey,n.altKey?r=t._edtHdl._toggleListBox(n):this._moveSel(i.Next,i.None,f));break;case wjcCore.Key.PageUp:this._altDown=n.altKey;this._moveSel(n.altKey?i.Home:i.PrevPage,i.None,f);break;case wjcCore.Key.PageDown:this._altDown=n.altKey;this._moveSel(n.altKey?i.End:i.NextPage,i.None,f);break;case wjcCore.Key.Home:this._moveSel(e?i.Home:i.None,i.Home,f);break;case wjcCore.Key.End:this._moveSel(e?i.End:i.None,i.End,f);break;case wjcCore.Key.Tab:r=this._performKeyAction(t.keyActionTab,f);break;case wjcCore.Key.Enter:r=this._performKeyAction(t.keyActionEnter,f);!f&&s&&s.currentEditItem!=null&&t._edtHdl._commitRowEdits();break;case wjcCore.Key.Escape:if(r=!1,s&&(s.currentAddItem||s.currentEditItem)){l=new CellRangeEventArgs(t.cells,t.selection);l.cancel=!0;t.onRowEditEnding(l);s.currentAddItem&&s.cancelNew();s.currentEditItem&&s.cancelEdit();t.onRowEditEnded(l);r=!0}t._mouseHdl.resetMouseState();break;case wjcCore.Key.Delete:case wjcCore.Key.Back:r=this._deleteSel(n);break;case wjcCore.Key.F2:r=this._startEditing(!0,n);break;case wjcCore.Key.F4:r=t._edtHdl._toggleListBox(n);break;default:r=!1}r&&(t.containsFocus()||t.focus(),n.preventDefault(),n.stopPropagation())}},n.prototype._performKeyAction=function(n,t){var i=SelMove;switch(n){case KeyAction.MoveDown:return this._moveSel(t?i.Prev:i.Next,i.None,!1),!0;case KeyAction.MoveAcross:return this._moveSel(i.None,t?i.Prev:i.Next,!1),!0;case KeyAction.Cycle:return this._moveSel(i.None,t?i.PrevCell:i.NextCell,!1),!0}return!1},n.prototype._keypress=function(n){var t=this._g;if(!t._wantsInput(n.target)&&!n.defaultPrevented){if(this._altDown){n.preventDefault();return}t.activeEditor?t._edtHdl._keypress(n):n.charCode>wjcCore.Key.Space&&this._startEditing(!1,n)&&t.activeEditor&&setTimeout(function(){var i=t.activeEditor;if(i&&i.type!='checkbox'){var r=t.selection,u=t.getCellData(r.row,r.col,!0),f=t.getCellData(r.row,r.col,!1);i.value=String.fromCharCode(n.charCode);wjcCore.isNumber(f)&&u.indexOf('%')>-1&&(i.value+='%');wjcCore.setSelectionRange(i,1);i.dispatchEvent(t._edtHdl._evtInput);t._edtHdl._keypress(n)}});n.stopPropagation()}},n.prototype._moveSel=function(n,t,i){this._g.selectionMode!=SelectionMode.None&&this._g._selHdl.moveSelection(n,t,i)},n.prototype._deleteSel=function(n){var t=this._g,r=t.editableCollectionView,u=t.selection,s=t.rows,f=[],v=new CellRange,h=new CellEditEndingEventArgs(t.cells,v,n),c=SelectionMode,i,l,a,e,y,o,p;if(t.allowDelete&&!t.isReadOnly&&(r==null||r.canRemove&&!r.isAddingNew&&!r.isEditingItem))switch(t.selectionMode){case c.CellRange:if(u.leftCol==0&&u.rightCol==t.columns.length-1)for(i=u.topRow;i>-1&&i<=u.bottomRow;i++)f.push(s[i]);break;case c.ListBox:for(i=0;i<s.length;i++)s[i].isSelected&&f.push(s[i]);break;case c.Row:u.topRow>-1&&f.push(s[u.topRow]);break;case c.RowRange:for(i=u.topRow;i>-1&&i<=u.bottomRow;i++)f.push(s[i])}if(f.length>0){for(r&&r.beginUpdate(),t.beginUpdate(),i=f.length-1;i>=0;i--)if(l=f[i],v.setRange(l.index,-1),t.onDeletingRow(h)){r&&l.dataItem?r.remove(l.dataItem):t.rows.removeAt(l.index);t.onDeletedRow(h)}return t.endUpdate(),r&&r.endUpdate(),t.selectionMode==c.ListBox&&(a=t.selection.row,a>-1&&a<t.rows.length&&(t.rows[a].isSelected=!0)),t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&f.length==0){for(r&&r.beginUpdate(),t.beginUpdate(),e=u.topRow;e<=u.bottomRow;e++)if(y=t.rows[e],!y.isReadOnly)for(o=u.leftCol;o<=u.rightCol;o++)if(p=t._getBindingColumn(t.cells,e,t.columns[o]),!p.getIsRequired()&&!p.isReadOnly&&t.getCellData(e,o,!0)&&(v.setRange(e,o),h.cancel=!1,t.onBeginningEdit(h))){r&&r.editItem(y.dataItem);t.setCellData(e,o,'',!0,!1);t.onCellEditEnding(h);t.onCellEditEnded(h)}return r&&(t._edtHdl._edItem=r.currentEditItem,r.endUpdate()),t.endUpdate(),t.selection=u,!0}return!1},n.prototype._startEditing=function(n,t,i,r){return this._g._edtHdl.startEditing(n,i,r,!0,t)},n}();exports._KeyboardHandler=_KeyboardHandler;_AR_ALLCELLS=4;_WJC_DRAGSRC='wj-state-dragsrc',function(n){n[n.None=0]="None";n[n.Columns=1]="Columns";n[n.Rows=2]="Rows";n[n.Both=3]="Both";n[n.ColumnsAllCells=n.Columns|_AR_ALLCELLS]="ColumnsAllCells";n[n.RowsAllCells=n.Rows|_AR_ALLCELLS]="RowsAllCells";n[n.BothAllCells=n.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing=exports.AllowResizing||(exports.AllowResizing={})),function(n){n[n.None=0]="None";n[n.Headers=1]="Headers";n[n.Cells=2]="Cells";n[n.Both=3]="Both"}(AutoSizeMode=exports.AutoSizeMode||(exports.AutoSizeMode={})),function(n){n[n.None=0]="None";n[n.Columns=1]="Columns";n[n.Rows=2]="Rows";n[n.Both=3]="Both"}(AllowDragging=exports.AllowDragging||(exports.AllowDragging={}));_MouseHandler=function(){function n(n){var i=this,t,r,u;this._tsLast=0;t=n.hostElement;this._g=n;this._dvMarker=wjcCore.createElement('<div class="wj-marker">&nbsp;</div>');n.addEventListener(t,'mousedown',function(t){var e,f,o;if(n._rcBounds=null,!t.defaultPrevented&&t.button==0){if(n.focus(),setTimeout(function(){t.defaultPrevented||n.focus()}),e=t.target,!n.activeEditor&&n._isInputElement(e)){if(wjcCore.getActiveElement()!=e&&e.tagName!='OPTION'){f=n.hitTest(t);switch(f.cellType){case CellType.Cell:n.select(f.range);break;case CellType.ColumnHeader:case CellType.ColumnFooter:n.scrollIntoView(-1,f.col);break;case CellType.RowHeader:n.scrollIntoView(f.row,-1)}}return}o=wjcCore.closest(t.target,'.wj-flexgrid');o&&o!=n.hostElement||i._isDown||(i._isDown=!0,n.addEventListener(document,'mousemove',r),n.addEventListener(document,'mouseup',u),i._mousedown(t))}});r=function(n){i._mousemove(n)};u=function(t){i._isDown=!1;n.removeEventListener(document,'mousemove');n.removeEventListener(document,'mouseup');i._mouseup(t)};n.addEventListener(t,'mousemove',this._hover.bind(this));n.addEventListener(t,'dblclick',this._dblclick.bind(this));n.addEventListener(t,'click',this._click.bind(this));n.addEventListener(t,'selectstart',function(t){n._isInputElement(t.target)||t.preventDefault()});n.addEventListener(t,'wheel',function(t){var i=n.cells.hostElement.parentElement;t.deltaY&&!t.ctrlKey&&!t.metaKey&&i.scrollHeight>i.offsetHeight&&wjcCore.closest(t.target,'.wj-flexgrid')==n.hostElement&&(i.scrollTop+=120*(t.deltaY<0?-1:1),t.preventDefault(),t.stopImmediatePropagation())});n.addEventListener(t,'dragstart',this._dragstart.bind(this));n.addEventListener(t,'dragover',this._dragover.bind(this));n.addEventListener(t,'dragleave',this._dragover.bind(this));n.addEventListener(t,'drop',this._drop.bind(this));n.addEventListener(t,'dragend',this._dragend.bind(this))}return n.prototype.resetMouseState=function(){var n,t;this._dragSource&&wjcCore.removeClass(this._dragSource,_WJC_DRAGSRC);this._showDragMarker(null);n=this._g.hostElement;n&&(n.style.cursor=null);t=this._g;t.removeEventListener(document,'mousemove');t.removeEventListener(document,'mouseup');this._tsLast=Date.now();this._eMouse=null;this._isDown=null;this._htDown=null;this._lbSelRows=null;this._szRowCol=null;this._szArgs=null;this._dragSource=null},n.prototype._mousedown=function(n){var t=this._g,i=t.hitTest(n),u=i.cellType,f,r;if(this._selDown=t.selection,i.panel==t.cells){if(wjcCore.closest(n.target,'.'+CellFactory._WJC_DROPDOWN)){n.preventDefault();t._edtHdl._toggleListBox(n,i.range);return}if(t.editRange&&t.editRange.contains(i.range))return}if(f=wjcCore.getActiveElement(),n.target!=f||!t._isInputElement(n.target)){if(u==CellType.None){t._edtHdl._commitRowEdits();return}if(this._htDown=i,this._eMouse=n,this._szRowCol!=null){this._handleResizing(n);return}switch(u){case CellType.Cell:n.ctrlKey&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(i.row);this._mouseSelect(n,n.shiftKey);break;case CellType.RowHeader:(this._g.allowDragging&AllowDragging.Rows)==0&&(n.ctrlKey&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(i.row),this._mouseSelect(n,n.shiftKey))}if(u==CellType.Cell&&t.rows.maxGroupLevel>-1&&wjcCore.closest(n.target,'.'+CellFactory._WJC_COLLAPSE)&&(r=wjcCore.tryCast(t.rows[i.row],GroupRow),r)){n.ctrlKey?t.collapseGroupsToLevel(r.isCollapsed?r.level+1:r.level):r.isCollapsed=!r.isCollapsed;this.resetMouseState();return}}},n.prototype._mousemove=function(n){if(this._htDown!=null){if(n.buttons==0&&this._eMouse&&n.timeStamp-this._eMouse.timeStamp>600){this.resetMouseState();return}if(this._eMouse=n,this._szRowCol)this._handleResizing(n);else switch(this._htDown.cellType){case CellType.Cell:this._mouseSelect(n,!0);break;case CellType.RowHeader:(this._g.allowDragging&AllowDragging.Rows)==0&&this._mouseSelect(n,!0)}}},n.prototype._mouseup=function(n){if(!this._dragSource||!this._g.isTouching){var i=this._g,r=i.hitTest(n),t=this._htDown,u=SelectionMode;if(t&&!n.defaultPrevented)if(this._szArgs)this._finishResizing(n);else if(t.panel!=i.topLeftCells||this._szArgs)t.panel!=i.columnHeaders||n.dataTransfer?t.panel==i.cells&&(n.ctrlKey||n.metaKey||n.shiftKey||r.panel==t.panel&&r.range.equals(t.range)&&i.selection.equals(this._selDown)&&i.startEditing(!0)):r.panel==t.panel&&r.col==t.col&&!r.edgeRight&&r.col>-1&&this._clickSort(n,r);else if(r.panel==t.panel&&r.row==t.row&&r.col==t.col)switch(i.selectionMode){case u.CellRange:case u.RowRange:case u.ListBox:i.select(new CellRange(0,0,i.rows.length-1,i.columns.length-1))}this.resetMouseState()}},n.prototype._click=function(n){Date.now()-this._tsLast>50&&this._handleClick(n)},n.prototype._handleClick=function(n){var t=this._g,u=n.target,i=new HitTestInfo(u,null),r;n.defaultPrevented||i.grid!=t||t._isInputElement(u)||(i.panel==t.topLeftCells?t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1)):i.panel==t.columnHeaders?this._clickSort(n,i):i.panel==t.rowHeaders?t.select(new CellRange(i.row,0,i.row,t.columns.length-1)):i.panel==t.cells&&(i.row<0?this._clickSort(n,i):wjcCore.closest(u,'.'+CellFactory._WJC_COLLAPSE)?(r=t.rows[i.row],r instanceof GroupRow&&(n.ctrlKey?t.collapseGroupsToLevel(r.isCollapsed?r.level+1:r.level):r.isCollapsed=!r.isCollapsed)):wjcCore.closest(u,'.'+CellFactory._WJC_DROPDOWN)?t._edtHdl._toggleListBox(n,i.range):t.select(i.range)))},n.prototype._clickSort=function(n,t){var i=this._g,s=i.collectionView,r,f,e,o;if(s&&s.canSort&&i.allowSorting){var h=t.range.bottomRow,c=t.panel.columns[t.col],u=i._getBindingColumn(t.panel,t.row,c);if((!(h>-1)||h==i._getSortRowIndex()||c!=u)&&u.allowSorting&&u.binding){for(r=t.grid.collectionView.sortDescriptions,f=null,e=0;e<r.length;e++)if(r[e].property==u.binding){f=!r[e].ascending;break}if(f==null){if(n.ctrlKey)return;f=!0}if(o=new CellRangeEventArgs(t.panel,t.range),i.onSortingColumn(o)){i._edtHdl._commitRowEdits();n.ctrlKey?r.clear():r.splice(0,r.length,new wjcCore.SortDescription(u._getBindingSort(),f));i.onSortedColumn(o)}}}},n.prototype._dblclick=function(n){var t=this._g,r=t.hitTest(n),u=r.cellType,s=t.selection,f=r.range,i,e,o,h;if(!n.defaultPrevented){if(r.edgeRight&&t.allowResizing&AllowResizing.Columns){if(u==CellType.ColumnHeader||u==CellType.Cell&&t.allowResizing&_AR_ALLCELLS){for(n.preventDefault(),n.ctrlKey&&s.containsColumn(r.col)&&(f=s),e=f.leftCol;e<=f.rightCol;e++)if(t.columns[e].allowResizing&&(i=new CellRangeEventArgs(t.cells,new CellRange(-1,e)),t.onAutoSizingColumn(i)&&t.onResizingColumn(i))){t.autoSizeColumn(e);t.onResizedColumn(i);t.onAutoSizedColumn(i)}}else if(u==CellType.TopLeft&&r.panel.columns[r.col].allowResizing&&(n.preventDefault(),i=new CellRangeEventArgs(r.panel,new CellRange(-1,r.col)),t.onAutoSizingColumn(i)&&t.onResizingColumn(i))){t.autoSizeColumn(r.col,!0);t.onAutoSizedColumn(i);t.onResizedColumn(i)}this.resetMouseState();return}if(r.edgeBottom&&t.allowResizing&AllowResizing.Rows){if(u==CellType.RowHeader||u==CellType.Cell&&t.allowResizing&_AR_ALLCELLS){for(n.ctrlKey&&s.containsRow(r.row)&&(f=s),o=f.topRow;o<=f.bottomRow;o++)if(t.rows[o].allowResizing&&(i=new CellRangeEventArgs(t.cells,new CellRange(o,-1)),t.onAutoSizingRow(i)&&t.onResizingRow(i))){t.autoSizeRow(o);t.onResizedRow(i);t.onAutoSizedRow(i)}}else if(u==CellType.TopLeft&&r.panel.rows[r.row].allowResizing&&(i=new CellRangeEventArgs(r.panel,new CellRange(r.row,-1)),t.onAutoSizingRow(i)&&t.onResizingRow(i))){t.autoSizeRow(r.row,!0);t.onResizedRow(i);t.onAutoSizedRow(i)}this.resetMouseState();return}if(u==CellType.Cell&&!t.activeEditor&&!t._isInputElement(n.target)&&(h=t._selHdl.selection,r.range.contains(h))){t.startEditing(!0);this.resetMouseState();return}}},n.prototype._hover=function(n){if(this._htDown==null){var i=this._g,t=i.hitTest(n),f=t.panel,r=t.cellType,u='default';return this._szRowCol=null,(r==CellType.ColumnHeader||r==CellType.TopLeft||r==CellType.Cell&&i.allowResizing&_AR_ALLCELLS)&&t.edgeRight&&(i.allowResizing&AllowResizing.Columns)!=0&&(this._szRowCol=this._getResizeCol(t)),(r==CellType.RowHeader||r==CellType.TopLeft||r==CellType.Cell&&i.allowResizing&_AR_ALLCELLS)&&t.edgeBottom&&(i.allowResizing&AllowResizing.Rows)!=0&&(this._szRowCol=this._getResizeRow(t)),this._szRowCol instanceof Column?u='col-resize':this._szRowCol instanceof Row&&(u='row-resize'),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,i.hostElement.style.cursor=u,t}return null},n.prototype._getResizeCol=function(n){for(var t,i=n.panel.columns,u=i[n.col],r=n.col+1;r<i.length;r++)if(t=i[r],t.visible){t.size<1&&(u=t);break}if(n.col==i.length-1&&(n.cellType==CellType.TopLeft||n.cellType==CellType.RowHeader))for(i=this._g.columns,r=0;r<i.length;r++)if(t=i[r],t.visible){t.size<1&&(u=t);break}return u.allowResizing?u:null},n.prototype._getResizeRow=function(n){for(var t,i=n.panel.rows,u=i[n.row],r=n.row+1;r<i.length;r++)if(t=i[r],t.visible){t.size<1&&(u=t);break}if(n.row==i.length-1&&(n.cellType==CellType.TopLeft||n.cellType==CellType.ColumnHeader))for(i=this._g.rows,r=0;r<i.length;r++)if(t=i[r],t.visible){t.size<1&&(u=t);break}return u.allowResizing?u:null},n.prototype._mouseSelect=function(n,t){var r=this,u=this._g,i;this._htDown&&this._htDown.panel&&u.selectionMode!=SelectionMode.None&&(i=new HitTestInfo(this._htDown.panel,n),this._handleSelection(i,t),!wjcCore.isIE9()&&n.button>=0&&(i=new HitTestInfo(u,n),i.cellType!=CellType.Cell&&i.cellType!=CellType.RowHeader&&setTimeout(function(){r._mouseSelect(r._eMouse,t)},100)))},n.prototype._handleResizing=function(t){var u;if(t.preventDefault(),this._szRowCol instanceof Column){var i=this._g,f=t.clientX+pageXOffset,r=Math.round(Math.max(n._SZ_MIN,this._szStart+(f-this._htDown.point.x)*(i.rightToLeft?-1:1)));this._szRowCol.renderSize!=r&&(this._szArgs==null&&(u=i.rowHeaders.columns.indexOf(this._szRowCol)>-1?i.rowHeaders:i.cells,this._szArgs=new CellRangeEventArgs(u,new CellRange(-1,this._szRowCol.index))),this._szArgs.cancel=!1,i.onResizingColumn(this._szArgs)&&(i.deferResizing||i.isTouching?this._showResizeMarker(r):this._szRowCol.width=r))}if(this._szRowCol instanceof Row){var i=this._g,e=t.clientY+pageYOffset,r=Math.round(Math.max(n._SZ_MIN,this._szStart+(e-this._htDown.point.y)));this._szRowCol.renderSize!=r&&(this._szArgs==null&&(u=i.columnHeaders.rows.indexOf(this._szRowCol)>-1?i.columnHeaders:i.cells,this._szArgs=new CellRangeEventArgs(u,new CellRange(this._szRowCol.index,-1))),this._szArgs.cancel=!1,i.onResizingRow(this._szArgs)&&(i.deferResizing||i.isTouching?this._showResizeMarker(r):this._szRowCol.height=r))}},n.prototype._dragstart=function(n){var i=this._g,t=this._htDown,r,u;t&&(this._dragSource=null,this._szRowCol||(r=new CellRangeEventArgs(t.panel,t.range),t.cellType==CellType.ColumnHeader&&i.allowDragging&AllowDragging.Columns&&t.col>-1&&i.columns[t.col].allowDragging?i.onDraggingColumn(r)?this._dragSource=n.target:n.preventDefault():t.cellType==CellType.RowHeader&&i.allowDragging&AllowDragging.Rows&&t.row>-1&&i.rows[t.row].allowDragging&&(u=i.rows[t.row],u instanceof GroupRow||u instanceof _NewRowTemplate||(i.onDraggingRow(r)?this._dragSource=n.target:n.preventDefault()))),this._dragSource&&n.dataTransfer&&!n.defaultPrevented&&(wjcCore._startDrag(n.dataTransfer,'move'),n.stopPropagation(),wjcCore.addClass(this._dragSource,_WJC_DRAGSRC),i.beginUpdate(),this._updating=!0))},n.prototype._dragend=function(){this._updating&&(this._g.endUpdate(),this._updating=!1);this.resetMouseState()},n.prototype._dragover=function(n){var i=this._g,t=i.hitTest(n),u=!1,r=new CellRangeEventArgs(i.cells,t.range);this._htDown&&t.cellType==this._htDown.cellType&&(t.cellType==CellType.ColumnHeader?(r.cancel=!i.columns.canMoveElement(this._htDown.col,t.col),u=i.onDraggingColumnOver(r)):t.cellType==CellType.RowHeader&&(r.cancel=!i.rows.canMoveElement(this._htDown.row,t.row),u=i.onDraggingRowOver(r)));u?(n.dataTransfer.dropEffect='move',this._showDragMarker(t),n.preventDefault(),n.stopPropagation()):this._showDragMarker(null)},n.prototype._drop=function(n){var t=this._g,i=t.hitTest(n),u=new CellRangeEventArgs(t.cells,i.range),r;if(this._htDown&&i.cellType==this._htDown.cellType)if(r=t.selection,i.cellType==CellType.ColumnHeader){t.columns.moveElement(this._htDown.col,i.col);t.select(r.row,i.col);t.onDraggedColumn(u)}else if(i.cellType==CellType.RowHeader){t.rows.moveElement(this._htDown.row,i.row);t.select(i.row,r.col);t.onDraggedRow(u)}this.resetMouseState()},n.prototype._showResizeMarker=function(n){var i=this._g,u=this._dvMarker,r,t;u.parentElement||i.cells.hostElement.appendChild(u);r=this._szArgs.panel.cellType;this._szRowCol instanceof Column?(t={display:'',left:this._szRowCol.pos+n-1,top:0,right:'',bottom:0,width:3,height:''},i.rightToLeft&&(t.left=i.cells.hostElement.clientWidth-t.left-t.width),(r==CellType.TopLeft||r==CellType.RowHeader)&&(t.left-=i.topLeftCells.hostElement.offsetWidth)):(t={left:0,top:this._szRowCol.pos+n-1,right:0,bottom:'',width:'',height:3},(r==CellType.TopLeft||r==CellType.ColumnHeader)&&(t.top-=i.topLeftCells.hostElement.offsetHeight));wjcCore.setCss(u,t)},n.prototype._showDragMarker=function(n){var r=this._g,i=this._dvMarker,t,u,f;if(!n){i.parentElement&&i.parentElement.removeChild(i);this._rngTarget=null;return}if(!n.range.equals(this._rngTarget)){this._rngTarget=n.range;i.parentElement||n.panel.hostElement.appendChild(i);t={display:'',left:0,top:0,width:6,height:6};switch(n.cellType){case CellType.ColumnHeader:t.height=n.panel.height;u=r.columns[n.col];t.left=u.pos-t.width/2;n.col>this._htDown.col&&(t.left+=u.renderWidth);r.rightToLeft&&(t.left=i.parentElement.clientWidth-t.left-t.width);break;case CellType.RowHeader:t.width=n.panel.width;f=r.rows[n.row];t.top=f.pos-t.height/2;n.row>this._htDown.row&&(t.top+=f.renderHeight)}wjcCore.setCss(i,t)}},n.prototype._finishResizing=function(t){var r=this._g,o=r.selection,h=this._eMouse.ctrlKey,i=this._szArgs,c=t.clientX+pageXOffset,l=t.clientY+pageYOffset,f,u,s,e;if(i&&!i.cancel&&i.col>-1){u=i.col;s=Math.round(Math.max(n._SZ_MIN,this._szStart+(c-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));i.panel.columns[u].width=Math.round(s);r.onResizedColumn(i);if(h&&this._htDown.cellType==CellType.ColumnHeader&&o.containsColumn(u))for(f=o.leftCol;f<=o.rightCol;f++)if(r.columns[f].allowResizing&&f!=u&&(i=new CellRangeEventArgs(r.cells,new CellRange(-1,f)),r.onResizingColumn(i))){r.columns[f].size=r.columns[u].size;r.onResizedColumn(i)}}if(i&&!i.cancel&&i.row>-1){u=i.row;s=Math.round(Math.max(n._SZ_MIN,this._szStart+(l-this._htDown.point.y)));i.panel.rows[u].height=Math.round(s);r.onResizedRow(i);if(h&&this._htDown.cellType==CellType.RowHeader&&o.containsRow(u))for(e=o.topRow;e<=o.bottomRow;e++)if(r.rows[e].allowResizing&&e!=u&&(i=new CellRangeEventArgs(r.cells,new CellRange(e,-1)),r.onResizingRow(i))){r.rows[e].size=r.rows[u].size;r.onResizedRow(i)}}},n.prototype._startListBoxSelection=function(n){var i=this._g.rows,t;for(this._lbSelState=!i[n].isSelected,this._lbSelRows={},t=0;t<i.length;t++)i[t].isSelected&&(this._lbSelRows[t]=!0)},n.prototype._handleSelection=function(n,t){var i=this._g,e=i.rows,f=i._selHdl.selection,u=new CellRange(n.row,n.col),o,r,s,h;if(n.row>-1&&n.col>-1)if(this._lbSelRows!=null){for(o=!1,u=new CellRange(n.row,n.col,this._htDown.row,this._htDown.col),r=0;r<e.length;r++)if(s=u.containsRow(r)?this._lbSelState:this._lbSelRows[r]!=null,s!=e[r].isSelected&&(h=new CellRangeEventArgs(i.cells,new CellRange(r,f.col,r,f.col2)),i.onSelectionChanging(h))){e[r]._setFlag(RowColFlags.Selected,s,!0);o=!0;i.onSelectionChanged(h)}o&&i.refreshCells(!1,!0,!0);i.scrollIntoView(n.row,n.col)}else n.cellType==CellType.RowHeader&&(u.col=0,u.col2=i.columns.length-1),t&&(u.row2=f.row2,u.col2=f.col2),i.select(u)},n}();_MouseHandler._SZ_MIN=0;exports._MouseHandler=_MouseHandler;_WJC_CHECKBOX='wj-cell-check';_EditHandler=function(){function n(n){var t=this;this._fullEdit=!1;this._list=null;this._g=n;this._evtInput=document.createEvent('HTMLEvents');this._evtInput.initEvent('input',!0,!1);n.selectionChanging.addHandler(function(i,r){var u;if(t.finishEditing()){if(u=n._selHdl.selection.row,u!=r.row){var f=n.rows.length,e=u>-1&&u<f?n.rows[u].dataItem:null,o=r.row>-1&&r.row<f?n.rows[r.row].dataItem:null;e!=o&&t._commitRowEdits()}}else r.cancel=!0});n.lostFocus.addHandler(function(){if(!n.containsFocus()){var i=wjcCore.getActiveElement();i&&getComputedStyle(i).position=='fixed'||t._commitRowEdits()}});n.addEventListener(n.hostElement,'mousedown',function(i){var f,u,r;i.defaultPrevented||i.button!=0||n._mouseHdl._szRowCol||(f=n.selection,u=n.hitTest(i),u.cellType!=CellType.Cell&&u.cellType!=CellType.None?t.finishEditing():u.cellType!=CellType.None&&(r=wjcCore.tryCast(i.target,HTMLInputElement),r&&r.type=='checkbox'&&!r.disabled&&!r.readOnly&&wjcCore.hasClass(r,_WJC_CHECKBOX)&&wjcCore.closest(r,'.wj-flexgrid')==n.hostElement&&(i.preventDefault(),t.startEditing(!1,u.row,u.col)&&(r=t.activeEditor,!r||r.type!='checkbox'||r.disabled||r.readOnly||(r.checked=!r.checked,r.focus(),t.finishEditing())))))},!0)}return n.prototype.startEditing=function(n,t,i,r,u){var f,o,s,h,a,c,y,e;if((n===void 0&&(n=!0),f=this._g,t=wjcCore.asNumber(t,!0,!0),i=wjcCore.asNumber(i,!0,!0),t==null&&(t=f.selection.row),i==null&&(i=f.selection.col),r==null&&(r=!0),!this._allowEditing(t,i))||(o=f.getMergedRange(f.cells,t,i),o||(o=new CellRange(t,i)),s=f.rows[t].dataItem,f.select(o,!0),!f.rows[t]||s!=f.rows[t].dataItem))return!1;if(o.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing()||(h=new CellRangeEventArgs(f.cells,o,u),!f.onBeginningEdit(h)))return!1;if(a=f.editableCollectionView,c=!1,a){if(s=f.rows[t].dataItem,c=s!=a.currentEditItem,c)f.onRowEditStarting(h);if(a.editItem(s),c){f.onRowEditStarted(h);this._edItem=s}}if(this._fullEdit=wjcCore.asBoolean(n),this._rng=o,this._list=null,y=f.columns[i].dataMap,y&&(this._list=y.getDisplayValues(s)),o.isSingleCell?this._updateEditorCell(t,i,c):f.refresh(!1),e=this._edt,e){e.type=='checkbox'?this._fullEdit=!1:r&&wjcCore.setSelectionRange(e,0,e.value.length);f.onPrepareCellForEdit(h);if(e=this._edt,!e||e.disabled||e.readOnly)return!1;if(e&&r&&(e.focus(),wjcCore.isNumber(f.getCellData(t,i,!1))&&e.value.indexOf('%')>-1)){for(var p=e.value,v=0,l=p.length;l>0&&p[l-1]=='%';)l--;while(v<l&&p[v]=='%')v++;wjcCore.setSelectionRange(e,v,l)}}return!0},n.prototype.finishEditing=function(n){var u,s,h,o,v,f,e,c;if(n===void 0&&(n=!1),u=this._edt,!u)return this._removeListBox(),!0;var t=this._g,i=this._rng,r=new CellEditEndingEventArgs(t.cells,i),l=t.containsFocus(),a=t.hostElement.querySelector('.wj-control.wj-state-focused');if(a&&(s=wjcCore.Control.getControl(a),s))s.onLostFocus(r);if(r.cancel=n,!n&&t.validateEdits&&(h=this._getValidationError(),h&&(r.cancel=!0,o=u.parentElement,o&&(wjcCore.toggleClass(o,'wj-state-invalid',!0),o.title=h,r.stayInEditMode=!0))),!t.onCellEditEnding(r)&&r.stayInEditMode)return l?setTimeout(function(){u.select()}):u.select(),!1;if(!r.cancel)for(r.data=t.cells.getCellData(i.topRow,i.leftCol,!1),v=t.cellFactory.getEditorValue(t),f=i.topRow;f<=i.bottomRow&&f<t.rows.length;f++)for(e=i.leftCol;e<=i.rightCol&&e<t.columns.length;e++)t.cells.setCellData(f,e,v,!0,!1);this._edt=null;this._rng=null;this._list=null;this._removeListBox();c=wjcCore.closest(u,'.wj-cell');wjcCore.contains(c,wjcCore.getActiveElement())&&c.focus();n?this._updateEditorCell(i.row,i.col,!1):t.refresh(!1);l&&t.focus();t.onCellEditEnded(r);return!0},Object.defineProperty(n.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0}),n.prototype.getClipString=function(n){var t=this._g,i='',h=!0,o=SelectionMode,u,f,e,s,r;if(!n){n=t.selection;switch(t.selectionMode){case o.Row:case o.RowRange:n.col=0;n.col2=t.columns.length-1;break;case o.ListBox:for(n.col=0,n.col2=t.columns.length-1,u=0;u<t.rows.length;u++)t.rows[u].isSelected&&t.rows[u].isVisible&&(n.row=n.row2=u,i&&(i+='\n'),i+=this.getClipString(n));return i}}for(n=wjcCore.asType(n,CellRange),f=n.topRow;f<=n.bottomRow;f++)if(t.rows[f].isVisible)for(h||(i+='\n'),h=!1,e=n.leftCol,s=!0;e<=n.rightCol;e++)t.columns[e].isVisible&&(s||(i+='\t'),s=!1,r=t.cells.getCellData(f,e,!0).toString(),r=r.replace(/\t/g,' '),(r.indexOf('\n')>-1||r.indexOf('"')>-1)&&(r='"'+r.replace(/"/g,'""')+'"'),i+=r);return i},n.prototype.setClipString=function(n,t){var o=this,i=this._g,c=t==null,s=SelectionMode;if(!t){t=i.selection;switch(i.selectionMode){case s.Row:case s.RowRange:case s.ListBox:t.col=0;t.col2=i.columns.length-1}}t=wjcCore.asType(t,CellRange);n=wjcCore.asString(n).replace(/\r\n/g,'\n').replace(/\r/g,'\n');n&&n[n.length-1]=='\n'&&(n=n.substring(0,n.length-1));c&&!t.isSingleCell&&(n=this._expandClipString(n,t));var f=new CellRange(t.topRow,t.leftCol),u=i.editableCollectionView,r=t.topRow,h=this._clipToRows(n),l=!1,e;i.deferUpdate(function(){var s,a,n,c;for(u&&u.beginUpdate(),s=0;s<h.length&&r<i.rows.length;s++,r++){if(!i.rows[r].isVisible){s--;continue}for(a=o._clipToCells(h[s]),n=t.leftCol,c=0;c<a.length&&n<i.columns.length;c++,n++){if(!i.columns[n].isVisible){c--;continue}if(o._allowEditing(r,n)){if(e=new CellRangeEventArgs(i.cells,new CellRange(r,n),a[c]),i.onPastingCell(e)&&(u&&(u.editItem(i.rows[r].dataItem),o._edItem=u.currentEditItem),i.cells.setCellData(r,n,e.data))){i.onPastedCell(e);l=!0}f.row2=Math.max(f.row2,r);f.col2=Math.max(f.col2,n)}}}u&&u.endUpdate();i.select(f)})},n.prototype._clipToRows=function(n){for(var r=[],i=0,u=!1,t=0;t<n.length;t++)switch(n[t]){case'"':u=!u;break;case'\n':u||(r.push(n.substr(i,t-i)),i=t+1)}return r.push(n.substr(i)),r},n.prototype._clipToCells=function(n){for(var t,u,i=n.split('\t'),r=0;r<i.length;r++)t=i[r],u=t.length,u>1&&t[0]=='"'&&t[u-1]=='"'&&(t=t.substr(1,u-2),t=t.replace(/""/g,'"')),i[r]=t;return i},n.prototype._expandClipString=function(n,t){var s,i,r;if(!n)return n;var h=n.split('\n'),o=h.length,e=0,c=[];for(i=0;i<o;i++){if(s=h[i].split('\t'),c.push(s),i>1&&s.length!=e)return n;e=s.length}var l=this._g,u=0,f=0;for(i=t.topRow;i<=t.bottomRow;i++)l.rows[i].isVisible&&u++;for(r=t.leftCol;r<=t.rightCol;r++)l.columns[r].isVisible&&f++;if((u>1||f>1)&&(u==1&&(u=o),f==1&&(f=e),f%e==0&&u%o==0))for(n='',i=0;i<u;i++)for(r=0;r<f;r++)i>0&&r==0&&(n+='\n'),r>0&&(n+='\t'),n+=c[i%o][r%e];return n},n.prototype._updateEditorCell=function(n,t,i){var r=this._g,u=r.cells.getCellElement(n,t),o=r._useFrozenDiv()&&(n<r.frozenRows||t<r.frozenColumns);if(!u||o||r._hasPendingUpdates())r.refresh(!1);else if(this._updateCell(u),i=i||r._getShowErrors(),i&&r.headersVisibility&HeadersVisibility.Row){var f=r.rowHeaders,s=f.columns.length-1,e=f.getCellElement(n,s);e&&this._updateCell(e)}},n.prototype._updateCell=function(n){var t=new HitTestInfo(n,null);t.panel&&(n.classList.add(FlexGrid._WJS_UPDATING),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,n,t.range),n.classList.remove(FlexGrid._WJS_UPDATING))},n.prototype._getValidationError=function(){var n=this._g,r;if(n._getShowErrors()){var t=this._rng.row,i=this._rng.col,u=n.cellFactory.getEditorValue(n),f=n.getCellData(t,i,!1);if(n.setCellData(t,i,u,!0,!1))return r=n._getError(n.cells,t,i),n.setCellData(t,i,f,!0,!1),r}return null},n.prototype._allowEditing=function(n,t){var i=this._g,r;return i.isReadOnly||i.selectionMode==SelectionMode.None?!1:n<0||n>=i.rows.length||i.rows[n].isReadOnly||!i.rows[n].isVisible?!1:t<0||t>=i.columns.length?!1:(r=i._getBindingColumn(i.cells,n,i.columns[t]),!r||r.isReadOnly||!r.isVisible)?!1:!0},n.prototype._commitRowEdits=function(){var n=this._g,t,i;if(this.finishEditing()&&this._edItem){if(t=n.editableCollectionView,t&&t.currentEditItem){i=new CellRangeEventArgs(n.cells,n.selection);n.onRowEditEnding(i);t.commitEdit();n.onRowEditEnded(i)}this._edItem=null}},n.prototype._keydown=function(n){switch(n.keyCode){case wjcCore.Key.F2:return this._fullEdit=!this._fullEdit,n.preventDefault(),!0;case wjcCore.Key.F4:return this._toggleListBox(n),n.preventDefault(),!0;case wjcCore.Key.Space:var t=this._edt;return!t||t.type!='checkbox'||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),n.preventDefault()),!0;case wjcCore.Key.Enter:case wjcCore.Key.Tab:return n.preventDefault(),!this.finishEditing();case wjcCore.Key.Escape:return n.preventDefault(),this.finishEditing(!0),!0;case wjcCore.Key.Up:case wjcCore.Key.Down:case wjcCore.Key.Left:case wjcCore.Key.Right:case wjcCore.Key.PageUp:case wjcCore.Key.PageDown:case wjcCore.Key.Home:case wjcCore.Key.End:if(this._lbx)return this._keydownListBox(n);if(n.altKey)switch(n.keyCode){case wjcCore.Key.Up:case wjcCore.Key.Down:return this._toggleListBox(n),n.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0},n.prototype._keydownListBox=function(n){var t=!0;if(this._lbx)switch(n.keyCode){case wjcCore.Key.Up:n.altKey?this._toggleListBox(n):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case wjcCore.Key.Down:n.altKey?this._toggleListBox(n):this._lbx.selectedIndex++;break;case wjcCore.Key.Home:case wjcCore.Key.PageUp:this._lbx.selectedIndex=0;break;case wjcCore.Key.End:case wjcCore.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return t?(n.preventDefault(),!0):!1},n.prototype._keypress=function(n){var t=this._edt,u,r,i;if(t&&t.type!='checkbox'&&this._list&&this._list.length>0&&n.charCode>=32)for(u=t.selectionStart,r=t.value.substr(0,u),n.target==t&&(u++,r+=String.fromCharCode(n.charCode)),r=r.toLowerCase(),i=0;i<this._list.length;i++)if(this._list[i].toLowerCase().indexOf(r)==0){t.value=this._list[i];wjcCore.setSelectionRange(t,u,this._list[i].length);t.dispatchEvent(this._evtInput);n.preventDefault();break}},n.prototype._toggleListBox=function(n,t){var i=this._g,f=i._selHdl.selection,r,u;return(t||(t=f),this._lbx&&(this._removeListBox(),f.contains(t)))?(i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus(),!0):(r=i.isTouching,u=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),!tryGetModuleWijmoInput()||!u.dataMap||u.showDropDown===!1)?!1:!tryGetModuleWijmoInput()||!this.startEditing(!0,t.row,t.col,!r,n)?!1:(this._lbx=this._createListBox(),this._lbx.showSelection(),r&&this._lbx.focus(),!0)},n.prototype._createListBox=function(){var u=this,n=this._g,t=this._rng,e=n.rows[t.row],o=n._getBindingColumn(n.cells,t.row,n.columns[t.col]),r=document.createElement('div'),i=new(tryGetModuleWijmoInput().ListBox)(r),f;return r.classList.add('wj-dropdown-panel','wj-grid-listbox'),i.maxHeight=e.renderHeight*4,i.itemsSource=o.dataMap.getDisplayValues(e.dataItem),i.selectedValue=n.activeEditor?n.activeEditor.value:n.getCellData(t.row,t.col,!0),wjcCore.addClass(r,o.dropDownCssClass),i.addEventListener(i.hostElement,'click',function(){u._removeListBox();n.focus();u.finishEditing()}),i.lostFocus.addHandler(function(){u._removeListBox()}),i.selectedIndexChanged.addHandler(function(){var t=n.activeEditor;t&&(t.value=u._lbx.selectedValue,t.dispatchEvent(u._evtInput),wjcCore.setSelectionRange(t,0,t.value.length))}),f=n.cells.getCellElement(t.row,t.col),f?wjcCore.showPopup(r,f,!1,!1,!1):(wjcCore.showPopup(r,n.getCellBoundingRect(t.row,t.col)),r[wjcCore.Control._OWNR_KEY]=n.hostElement),i},n.prototype._removeListBox=function(){this._lbx&&(wjcCore.hidePopup(this._lbx.hostElement,!0),this._lbx.dispose(),this._lbx=null)},n}();exports._EditHandler=_EditHandler;_AddNewHandler=function(){function n(n){this._nrt=new _NewRowTemplate;this._g=n;this._keydownBnd=this._keydown.bind(this);this._attach()}return Object.defineProperty(n.prototype,"newRowAtTop",{get:function(){return this._top},set:function(n){n!=this.newRowAtTop&&(this._top=wjcCore.asBoolean(n),this.updateNewRowTemplate())},enumerable:!0,configurable:!0}),n.prototype.updateNewRowTemplate=function(){var n=this._g,f=n.editableCollectionView,t=n.rows,e=f&&f.canAddNew&&n.allowAddNew&&!n.isReadOnly,i=t.indexOf(this._nrt),o=this._top?0:t.length-1,u=!1,r;!e&&i>-1?(r=n.selection,r.row==i&&n.select(r.row-1,r.col),t.removeAt(i)):e&&(i<0?u=!0:i!=o&&(t.removeAt(i),u=!0),u&&(this._top?t.insert(0,this._nrt):t.push(this._nrt)),this._nrt&&this._nrt._setFlag(RowColFlags.ParentCollapsed,!1))},n.prototype._attach=function(){var n=this._g;n&&(n.beginningEdit.addHandler(this._beginningEdit,this),n.pastingCell.addHandler(this._beginningEdit,this),n.rowEditEnded.addHandler(this._rowEditEnded,this),n.loadedRows.addHandler(this.updateNewRowTemplate,this),n.hostElement.addEventListener('keydown',this._keydownBnd,!0))},n.prototype._detach=function(){var n=this._g;n&&(n.beginningEdit.removeHandler(this._beginningEdit),n.pastingCell.removeHandler(this._beginningEdit),n.rowEditEnded.removeHandler(this._rowEditEnded),n.loadedRows.removeHandler(this.updateNewRowTemplate),n.hostElement.removeEventListener('keydown',this._keydownBnd,!0))},n.prototype._keydown=function(n){n.defaultPrevented||n.keyCode!=wjcCore.Key.Escape||this._g.activeEditor==null&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())},n.prototype._beginningEdit=function(n,t){var u,i,r;if(!t.cancel&&(u=this._g.rows[t.row],wjcCore.tryCast(u,_NewRowTemplate)&&(i=this._g.editableCollectionView,i&&i.canAddNew)))if(this._top){if(this._nrt.dataItem==null){var r=null,f=i.sourceCollection,e=i.newItemCreator;r=wjcCore.isFunction(e)?e():f&&f.length?new f[0].constructor:{};this._nrt.dataItem=r}}else{r=i.currentAddItem&&i.currentAddItem==u.dataItem?i.currentAddItem:i.addNew();i.moveCurrentTo(r);this.updateNewRowTemplate();this._g.refresh(!0);this._g.onRowAdded(t);t.cancel&&i.cancelNew()}},n.prototype._rowEditEnded=function(n,t){var r=this,i=this._g.editableCollectionView,u=this._nrt.dataItem,e,f;if(i)if(i.isAddingNew)i.commitNew();else if(u&&!t.cancel){this._nrt.dataItem=null;e=i.addNew();for(f in u)e[f]=u[f];this._g.onRowAdded(t);t.cancel?i.cancelNew():i.commitNew();setTimeout(function(){r._g.select(0,r._g.columns.firstVisibleIndex);r.updateNewRowTemplate()},20)}},n}();exports._AddNewHandler=_AddNewHandler;_NewRowTemplate=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(Row);exports._NewRowTemplate=_NewRowTemplate;_ImeHandler=function(){function n(t){this._g=t;this._tbx=wjcCore.createElement('<input class="wj-grid-editor wj-form-control wj-grid-ime"/>');wjcCore.setCss(this._tbx,n._cssHidden);t.cells.hostElement.parentElement.appendChild(this._tbx);this._updateImeFocus();var i=t.hostElement;t.addEventListener(this._tbx,'compositionstart',this._compositionstart.bind(this));t.addEventListener(i,'blur',this._updateImeFocus.bind(this),!0);t.addEventListener(i,'focus',this._updateImeFocus.bind(this),!0);t.addEventListener(i,'mousedown',this._mousedown.bind(this),!0);t.addEventListener(i,'mouseup',this._mouseup.bind(this),!0);t.cellEditEnded.addHandler(this._cellEditEnded,this);t.selectionChanged.addHandler(this._updateImeFocus,this)}return n.prototype.dispose=function(){var n=this._g,t=n.hostElement;n.removeEventListener(this._tbx,'compositionstart');n.removeEventListener(t,'blur');n.removeEventListener(t,'focus');n.removeEventListener(t,'mousedown');n.removeEventListener(t,'mouseup');n.cellEditEnded.removeHandler(this._cellEditEnded);n.selectionChanged.removeHandler(this._updateImeFocus);this._tbx.parentElement&&this._tbx.parentElement.removeChild(this._tbx)},n.prototype._cellEditEnded=function(){wjcCore.setCss(this._tbx,n._cssHidden);this._tbx.value=''},n.prototype._compositionstart=function(){var n=this._g,t,f,u,s;if(n.activeEditor==null&&(t=n._selHdl.selection,n.startEditing(!1,t.row,t.col,!1))){t=n.editRange;var i=n.cells.hostElement,e=n.columns[t.col].pos+i.offsetLeft,o=n.rows[t.row].pos+i.offsetTop,r=n.getCellBoundingRect(t.row,t.col);t.isSingleCell||(f=n.cells.getCellElement(t.row,t.col),r.width=f.offsetWidth,r.height=f.offsetHeight);t.row<n.frozenRows&&(o+=i.parentElement.scrollTop);t.col<n.frozenColumns&&(e+=i.parentElement.scrollLeft);u=n.activeEditor;s=u&&u.parentElement?u.parentElement.style.zIndex:'';wjcCore.setCss(this._tbx,{position:'absolute',pointerEvents:'',opacity:'',left:e,top:o,width:r.width-1,height:r.height-1,zIndex:s});n._edtHdl._edt=this._tbx}},n.prototype._mousedown=function(){this._mouseDown=!0;this._updateImeFocus()},n.prototype._mouseup=function(){this._mouseDown=!1;this._updateImeFocus()},n.prototype._updateImeFocus=function(){var t=this._g,i=wjcCore.getActiveElement(),n;t.activeEditor||t.isTouching||this._mouseDown||!wjcCore.contains(t.hostElement,i)||(n=this._tbx,this._enableIme()?i!=n&&(n.disabled=!1,n.select()):n.disabled=!0)},n.prototype._enableIme=function(){var n=this._g,t=n.selection;return n.canEditCell(t.row,t.col)?n.columns[t.col].dataType==wjcCore.DataType.Boolean?!1:!0:!1},n}();_ImeHandler._cssHidden={position:'fixed',pointerEvents:'none',opacity:0,left:-10,top:-10,width:0};exports._ImeHandler=_ImeHandler